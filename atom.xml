<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Dawell的博客</title>
  <subtitle>我不是一个简单的少年~</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://dawell.github.io/"/>
  <updated>2018-11-26T09:16:30.229Z</updated>
  <id>https://dawell.github.io/</id>
  
  <author>
    <name>Dawell</name>
    <email>355398356@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>轩辕剑苍之曜游戏体验</title>
    <link href="https://dawell.github.io/2018/11/25/%E8%BD%A9%E8%BE%95%E5%89%91%E8%8B%8D%E4%B9%8B%E6%9B%9C%E6%B8%B8%E6%88%8F%E4%BD%93%E9%AA%8C/"/>
    <id>https://dawell.github.io/2018/11/25/轩辕剑苍之曜游戏体验/</id>
    <published>2018-11-25T07:21:39.000Z</published>
    <updated>2018-11-26T09:16:30.229Z</updated>
    
    <content type="html"><![CDATA[<h3 id="为什么体验轩辕剑手游"><a href="#为什么体验轩辕剑手游" class="headerlink" title="为什么体验轩辕剑手游"></a>为什么体验轩辕剑手游</h3><p>作为轩辕剑的脑残粉，最喜欢的作品不是大众所知的轩辕剑3外传天之痕系列，而是我在初中第一次玩到的轩辕剑4这部作品</p>
<p>轩4是真人比例的3dRPC游戏，当时体验到国产能做成这样真的很震撼，而且剧情非常有意思，砍头三人组，黑火，壶中仙，幻影秦始皇，云之界，还有2代老人物登场</p>
<p>还有各种好玩的系统：天书、DOMO工作室、机关术、隐藏BOSS撒旦与蚩尤，当时游戏中期还能操作机关干架真的是独特的体验，隐藏的DOMO还给了主角奇怪的招数，轩辕菜刀之类的东西</p>
<p>轩4之后又玩了轩4外传苍之涛，苍之涛更是加入了穿越时空的背景故事，几个时空交错的剧情真的是让我非常震撼，还有神器太一轮的引入，历史中确实有很多相似点</p>
<p>最近轩辕剑竟然出了动漫苍之曜，必看，后来得知还有同名手游推出，必玩，于是早早预约，11月21日开放了下载，因为没有抢到激活码，还在淘宝买了一个体验</p>
<h3 id="游戏体验"><a href="#游戏体验" class="headerlink" title="游戏体验"></a>游戏体验</h3><p>总结游戏体验：3缺点1优点，剧情没啥意思，操作傻瓜式后期无聊，朋友交互几乎没有，玩法确实多样<br>体验了游戏4天，基本已经感觉没什么乐趣了，所以已经弃玩之<br>不过在6000激活码的体验服中拿到了一些成就，这里最大的成就就是天书系统拿到了全服务器第一名的成绩<br>第三天是拿到并列第一，第四天就超过了第二名一大截，成就感满满~</p>
<p>晒一下：<br><img src="http://ww1.sinaimg.cn/large/712a7015ly1fxkhdbd17sj21hc0u0b2b.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/712a7015ly1fxkhdsbl5pj21hc0u0b2b.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/712a7015ly1fxkhby3h63j21hc0u07wh.jpg" alt=""></p>
<h4 id="剧情"><a href="#剧情" class="headerlink" title="剧情"></a>剧情</h4><p>本以为游戏是动画剧情的补充，一开始不停的刷关卡，看后续是否有与动画或者世界观有关的剧情<br>发现后面都是与从军的上级、平级、下级的对话，无聊的要死<br>一开始就是主角战斗快死亡的时候被机关术主管拿去做实验，做了个机关臂，作为帝国高科技派到前线作战，同时还派人保护防止科技遗失在战场，对方是异国军队，什么x坨兵<br>剧情一共三大章，第一章打打小兵，boss是一个千手男，大招全四周攻击，第二章应该是前线吧，boss是士兵军官，会斩击，第三章应该是杀入敌营，不过实在没意思没有玩到最后<br>老大最初给了天书碎片可以建造自己的天书世界，里面还有个MM管理着，天书可以养成木甲，每个特殊木甲还有独立的一些养成剧情，什么发现小女孩、大白兔、陪钓鱼练剑的，更加无聊</p>
<p>总体上虽然是叫做苍之曜，但是完全与宏伟的世界观关系不大，就是一个独立的小故事，打一场仗而已，完全独立，这里面与轩辕剑有点关系就是木甲：拓跋玉儿与云了</p>
<h4 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h4><p>玩法确实多样，一个是采用战斗副本的模式，副本中3d战斗，同时提供了建造，养成的功能</p>
<ol>
<li>战斗：即时战斗，不过顶多3个技能+一个大招，配合3个作战的木甲大招，后期就是按照五行属性依次按就可以了，比较简单，所以我一直在想：手游真的适合做即时战斗么？完全没啥意思。。。</li>
<li>建造：这个可以说是游戏中最有意思的地方了，天书我从4代就喜欢，这里就增加了更多建筑，而且天书建设更加自由多样，最终也主要是玩了玩这个，我在玩家群里也讨论了下，都觉得这一块都可以独立做成一个游戏了</li>
<li>养成：这里的木甲就和其他网游中的宠物一样，也是与主角一样拥有各种属性，协同作战，为了提升战斗力，还要氪金养宠物的各种属性，后面开启的天赋系统真的是让我惊了，这要氪多少金才能点满~</li>
<li>交互：几乎没有联机的部分，只能看到一个世界聊天，而联机只有在国战的里面有联合作战，其他基本上就是一个单机游戏</li>
<li>任务：一次性任务：刷主线副本、刷困难副本、升级各种天书，周期性任务：每日xxx，还有国战系统，可以做木甲、主角、协同3种贡献，一个副本要刷2遍，普通困难，无聊的话很难受</li>
<li>氪金：氪金的地方太多了，体力，刷图也有限制，各种装备升级，木甲养成，甚至建造里的东西都需要氪金，不过我总体体验下来根本不值这个钱</li>
<li>辅助：有排行榜功能，不过没有成就系统，拿了第一感觉也没什么用；有耐脸系统</li>
<li>属性：主要是战力，与技能，还有五行，没有魔法；生命、攻击、防御、闪避、韧性、破甲、精准、暴击，其他五行伤害与防御</li>
<li>界面：活动（每日签到、累计签到、吃饭、公众号与兑换码）、福利（等级+战力、成长任务）、任务、提升、军报（邮件）；战斗（军事）、提升（个人、机关臂）、物品（装备、物品、物资）、战友、外形（易容、更衣）、排行、设置</li>
<li>提升：调和（困难关卡）、装备（套装、强化、精炼）、机关臂（制造-机关臂、炉心、部件-技能配合五行、研发-属性强化+技能属性、强化+替换+觉醒方向）、</li>
<li>天书：生产资源（采矿、伐木、染料、药草、熔炼）、功能（炼丹制药、制造机甲、造装备、熔炼、木甲读书、木甲任务、我练武、我仓库、天书核心）、装饰（门、树、动物）</li>
</ol>
<p>提升的点总结</p>
<ol>
<li>刷图零件:制造机械臂、制造防具、强化机械臂、强化防具</li>
<li>国战提升:精炼防具、炉心</li>
<li>人民币:炉心、制造机械臂、制造防具</li>
<li>木甲-宠物:养护，等级；突破，星级；天赋，分解材料；零件，装备</li>
</ol>
<h3 id="经历"><a href="#经历" class="headerlink" title="经历"></a>经历</h3><p>一个图至少刷2遍，一遍普通，一遍困难</p>
<p>有些特殊困难图带走升级装备的道具，所以每日必刷，一图限制3次，不过如果有人民币可以每次购买次数刷</p>
<p>天书刷到了全服第一，感觉这游戏唯一的成就了</p>
<ol>
<li>第一天单机地下城刷图即时战斗游戏</li>
<li>第二天是个建造类游戏，刷图普通困难刷完</li>
<li>第三天木甲养成类游戏，卡关，建造全服第一</li>
<li>第四天主角战力养成游戏，刷图为养战力，最终战力1w+，全服50以内</li>
</ol>
<p>有几张图特别难刷，导致花钱都卡关，感觉难度不合理</p>
<h3 id="其他轩辕剑游戏对比"><a href="#其他轩辕剑游戏对比" class="headerlink" title="其他轩辕剑游戏对比"></a>其他轩辕剑游戏对比</h3><p>这一部游戏相当于是玩到的轩辕剑相关的第4部手游</p>
<ol>
<li>第一个玩的是个Q版天之痕背景的各种穿越打BOSS，可以拿到小雪角色什么的，回合制，昆仑镜城镇各种</li>
<li>第二个是非常Q版的也是天之痕背景，也是时间错乱了，各代角色都变为了BOSS，回合制杀杀杀，全横版地图跑跑跑，可以自动刷图</li>
<li>第三个是之前的龙舞云山，水墨画风，剧情为主，总体上还可以，回合制隐墨宗的战斗也非常爽，不过剧情玩完了就无聊了，7天就不想玩了</li>
<li>第四个就是这个苍之曜，完全与轩辕剑无关的剧情，就是一个人的战斗，建筑，养成，无聊</li>
</ol>
<p>而第一个第二个由于都是YY的剧情，这个与无剧情是一样的，浪费时间，而且战斗非常水，差评，第四个无剧情，也是差评<br>总体上第三个剧情是比较满意的，基本上大家都是借着轩辕剑的IP用了里面的名词去造游戏，剧情YY下不相关的，战斗体验的话3与4都认可，不过我更喜欢做个策略类的卡牌游戏可能才最适合手机</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>回合制完全是策略问题，卡牌最适合，做成动画冗余不宜长，只能说好一点的卡牌游戏了，简单，加速，增益，药品，boss特点固定手法<br>因为策略相同，重复无聊，所以有打过图后自动刷图的机制<br>即时战斗:随机性多，考虑闪避能力，自动锁定战斗对象，一顿属性约束按键，希望多刷图，所以设置奖励<br>都有疲劳限制，需要进餐充钱才能继续刷<br>手游考虑成本，回合制有真实地图走动，而即时战斗固定一个家，按地下城刷图，所谓静动结合的的搭配</p>
<p>RPC手游的要点：动静结合，多玩法，各种附属提升氪金<br>目前觉得最好玩的RPG模式：基础包免费，增值角色剧情收费，策略类回合制卡牌制RPG最适合手机玩，跑地图、即时战斗都不太舒服，这么小的屏幕不如PC合适<br>玩氪金游戏的省钱秘诀：玩测试服，可以大量用系统发的东西氪金体验到完整的游戏体验，还不用花钱</p>
<p>最后附上我捏脸的角色留个纪念：<br><img src="http://ww1.sinaimg.cn/large/712a7015ly1fxkhf6mkb3j21hc0u01kx.jpg" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;为什么体验轩辕剑手游&quot;&gt;&lt;a href=&quot;#为什么体验轩辕剑手游&quot; class=&quot;headerlink&quot; title=&quot;为什么体验轩辕剑手游&quot;&gt;&lt;/a&gt;为什么体验轩辕剑手游&lt;/h3&gt;&lt;p&gt;作为轩辕剑的脑残粉，最喜欢的作品不是大众所知的轩辕剑3外传天之痕系列，而是我
    
    </summary>
    
      <category term="娱乐" scheme="https://dawell.github.io/categories/%E5%A8%B1%E4%B9%90/"/>
    
    
      <category term="游戏" scheme="https://dawell.github.io/tags/%E6%B8%B8%E6%88%8F/"/>
    
      <category term="轩辕剑" scheme="https://dawell.github.io/tags/%E8%BD%A9%E8%BE%95%E5%89%91/"/>
    
  </entry>
  
  <entry>
    <title>DNF私服怀旧体验</title>
    <link href="https://dawell.github.io/2018/11/08/DNF%E7%A7%81%E6%9C%8D%E6%80%80%E6%97%A7%E4%BD%93%E9%AA%8C/"/>
    <id>https://dawell.github.io/2018/11/08/DNF私服怀旧体验/</id>
    <published>2018-11-08T12:54:02.000Z</published>
    <updated>2018-11-25T10:33:09.199Z</updated>
    
    <content type="html"><![CDATA[<p>高中玩过的最好玩的网友：DNF，10年过去了，现在又想重温总结下</p>
<p>但是这是个超级耗时间的游戏，腾讯的游戏还耗费金钱，所以找到了私服or单机版的玩了玩，做完了所有主线与支线任务花了1周左右，也完整了体验到了最新的剧情</p>
<p>其实以前是很少关注剧情的，做任务都是快速跳过了，这次回顾发现DNF的剧情可以说是非常的赞，当做小说看都可以，其实官方就有编年史与小说等剧情完善，但是一直都不care</p>
<p>所以这篇总结主要分2部分，一个是游戏体验，一个是剧情</p>
<h3 id="体验历程"><a href="#体验历程" class="headerlink" title="体验历程"></a>体验历程</h3><h4 id="私服目的"><a href="#私服目的" class="headerlink" title="私服目的"></a>私服目的</h4><ol>
<li>其他职业其实可以生满级然后看看大招什么的，就没必要这样一条龙看剧情了，可以快速升级尝试</li>
<li>把DNF当做一个单机游戏来玩，并且做回有钱人，看看最终自己能否刷完所有的图，这样体验更完整，看下整体的剧情<ol>
<li>现在就是可以挑战一些人民币才能挑战的地下城，其实这些地下城才是有核心剧情的地方</li>
</ol>
</li>
<li>手感没了，按键大招一排，有的职业多了还有连击设计，无语，累，不爽</li>
</ol>
<h4 id="新老区别"><a href="#新老区别" class="headerlink" title="新老区别"></a>新老区别</h4><ol>
<li>现在的等级差异：过去满级60级，现在是90级，19年2月开放95级</li>
<li>地图差异：开放了异次元（70级副本）、三番街（GBL、酒馆、绿都）、天界的3块地图（根特、海上列车、发电厂）、虚祖（时间之门、擂台）、盗贼那边里开放了新地下城、多出了一些NPC</li>
<li>功能差异：增加了任务地下城分类、技能树、TP点、新技能</li>
<li>角色：新增了女角色、其他特殊角色</li>
</ol>
<h4 id="地下城区域"><a href="#地下城区域" class="headerlink" title="地下城区域"></a>地下城区域</h4><p>基础：新手（5级），森林（20级），海底（30级），天空（40级），地下（45级），山上（50级）<br>高级：三海（55级），沙漠（60级），根特（70级），虚祖时间（70级，阿拉德真相！），列车（80级），发电（90级）<br>额外：各种塔挑战，山麓？，擂台<br>高难（刷装备）：远古（需开挂），深渊（需开挂），异次元空间（需开挂），虚祖时间之门次元异界（需开挂）</p>
<ol>
<li>先是阿尔特防线新手区森林（2个地图，<strong>2个隐藏远古地下城</strong>）</li>
<li>格兰之森（5个地图，1个隐藏暗黑僵尸）：森林，哥布林，猫妖，僵尸，隐藏暗黑</li>
<li>水下（天空之城，6个地图，1个隐藏悬空城），龙人，玩偶人偶，钢铁士兵，隐藏悬天空城</li>
<li>天上飞城（天帷巨兽，默认7个地图，1个隐藏天帷禁地）:教会，章鱼，炮头，树精，夜叉</li>
<li>地下溶洞（诺伊佩拉+暗黑城，默认只有6个地图，<strong>2个隐藏古代地下城</strong>）：暗夜精灵，地下醉鬼，鬼魂，巨人，各种召唤精灵<ol>
<li>诺伊佩拉古代地下城：诺伊佩拉</li>
<li>暗黑城古代地下城：王的遗迹，每关都是boss（风火光）</li>
</ol>
</li>
<li>雪山（8张地图，2个隐藏地图）：猩猩，石巨人，族人，狼人，石头人，各种大召唤精灵<ol>
<li>冰心少年守护站：新玩法</li>
<li>隐藏：布加族挑战组人赛</li>
<li>隐藏：冰龙王最难</li>
</ol>
</li>
<li>三番街（3+2+1，6张地图）：海岸三岔路，坠落之殿GBL、绿都超能力者、垃圾、酒馆小弟<ol>
<li>坠落之殿GBL：罗杰斯的信徒，什么人体实验，孵化地搞死结束</li>
<li>月光酒馆:也是越打房间越多，挑战</li>
<li>还有陌路者要塞：绿都，稻草人，虫子，德鲁伊，也是挑战型，每次多房间，异能</li>
<li>黑帮老大与小弟，哥布林，热血总是进深渊，没法刷了，而且只能第一次进去，从天界掉下来的人</li>
</ol>
</li>
<li>诺斯玛尔（4个地下城，<strong>1个隐藏远古地下城</strong>）：盗贼，狗，人，石像，蚂蚁，蝴蝶，泥巴，沙漠，魔女</li>
<li>虚祖-时间之门（8个图）</li>
<li>天界-根特：士兵</li>
<li>天界-海上列车:</li>
<li>天界-发电厂：</li>
<li>异次元裂缝（6张地图）：</li>
<li>虚祖时间之门次元异界（真远古6张图）：</li>
</ol>
<h4 id="私服刷图经验"><a href="#私服刷图经验" class="headerlink" title="私服刷图经验"></a>私服刷图经验</h4><ol>
<li>刷图太难，95级70多的图刷不动，真的是累觉不爱，放弃，太浪费时间，如果有外挂就很开心了，自动化刷图，私服里后来开启GM工具发点装备就好刷很多了</li>
<li>有些任务需要材料很多要频繁刷图：无重力碎片，炮身，坚韧的触须，邪恶结晶，在凯里那里都有卖，根本不用刷图！</li>
<li>地下城，每个都有隐藏地图，做任务触发</li>
<li>很多称号任务要刷好几遍，没意思，这种称号任务可以不做</li>
<li>有一些装备任务也要刷图好几遍，不过如果是90级之前的装备也可以不去做，淘汰了</li>
<li>选物品费时间，直接退出即可，虚弱，不过这样刷图快</li>
<li>作为一个人民币玩家，一天一个大片区域，后面虚弱退出的话更效率点</li>
</ol>
<p>刷图节奏（1行1天，一共玩了10天做完了所有任务）</p>
<ol>
<li>洛兰+格兰之森</li>
<li>天空之城</li>
<li>天帷巨兽</li>
<li>诺伊佩拉+暗黑城</li>
<li>雪山</li>
<li>三番街+盗贼</li>
<li>阿拉德难图：远古+异次元裂缝（效率开挂）</li>
<li>虚祖2图：时间之门+真远古（效率开挂）</li>
<li>天界3图用了2天（效率开挂）</li>
</ol>
<h4 id="游戏场景设计"><a href="#游戏场景设计" class="headerlink" title="游戏场景设计"></a>游戏场景设计</h4><p>主要有4个大版图</p>
<ol>
<li>阿拉德大陆（60级）</li>
<li>阿拉德天空之上是海，海上是天界，也就是人类的地方（70级）</li>
<li>阿拉德往北连接虚祖（80级）</li>
<li>天界通过寂静城连接魔界（90级）</li>
</ol>
<p>海陆空都有场景，其中陆地最为丰富</p>
<ol>
<li>海：天空之城里</li>
<li>空：天帷巨兽</li>
<li>陆：细分为山上，地下，路面，路面分森林，沙漠，人类多个城市<ol>
<li>山上：雪山</li>
<li>地下：暗夜精灵溶洞，暗黑城</li>
<li>森林：格兰之森、洛兰</li>
<li>沙漠戈壁：盗贼</li>
<li>人类：三番街（GBL、酒馆、绿都），天界3个地方，虚祖</li>
</ol>
</li>
</ol>
<p>人类城市特点</p>
<ol>
<li>天界根特：日本，海贼</li>
<li>虚祖：武士都，中国元素</li>
</ol>
<p>规律</p>
<ol>
<li>一个地区会有4-8个地下城，前几个都是单兵种，最后一个混合兵种</li>
<li>每个都有个固定的BOSS：悬空城BOSS，天帷巨兽罗杰斯，地下锁链，雪山冰雪女+雪山冰龙王，GBL有个</li>
<li>任务刷多遍套路：第一遍见他/调查，第二遍打到他，第三遍通知他/研究他</li>
</ol>
<h3 id="剧情"><a href="#剧情" class="headerlink" title="剧情"></a>剧情</h3><p>我最剧情真正感兴趣的导火索是在刷时间之门的时候，先是感受到了西岚的厉害，然后得知了部分阿拉德这些地下城之所以这样的原因<br>产生了剧情上的兴趣，后来又去挖掘了下剧情发现了一个庞大的世界观与故事背景<br>后又去刷远古完善了线索与剧情<br>dnf里其他故事也参考历史故事改写，比如阿拉丁参考亚瑟王的故事，都是被背叛，都持有王者之剑<br>比较细节的是装备上都有故事有剧情的，以前都没注意到，谁的装备说谁的故事</p>
<h4 id="远古地下城剧情"><a href="#远古地下城剧情" class="headerlink" title="远古地下城剧情"></a>远古地下城剧情</h4><p>远古地图位置</p>
<ol>
<li>洛兰（有2个远古）</li>
<li>格兰之森、天空之城、天帷巨兽：无</li>
<li>诺伊佩拉+暗黑城（有2个远古，有异次元裂缝）</li>
<li>万年雪山、海岸三番街：无</li>
<li>诺斯玛尔（一个远古，帝国骑士团）</li>
<li>异次元裂缝（异次元裂缝，不一定算成远古）</li>
<li>山麓（活动地图，限时开放，单机版恶搞了一个腾讯总部副本，4剑圣，死亡之塔里的高手）</li>
<li>天界（有2个远古）</li>
</ol>
<p>阿拉德的远古（一共5个，3个与使徒有关，1个独立故事，1个与魔界泰拉有关）</p>
<ol>
<li>远古-悲鸣洞穴：就是鬼剑士开场动画中讨伐使徒希洛克后的洞穴，阿甘左伤心处，死去了爱人，希洛克使徒的遗留意志在这里，BOSS大虫子</li>
<li>远古-比尔马克帝国试验场：当时帝国用泰拉石做实验的地方，机械牛，泰拉石，这里可以打造泰拉石装备</li>
<li>远古地下城-王的遗迹（独立故事）：在暗黑城，古代阿拉丁，在千年以前用分封制统治阿拉德的国家，后分主背叛，王封印自己族人到地下保全，参考亚瑟王圆桌骑士故事</li>
<li>远古-诺伊佩拉（主线）：BOSS为狄瑞吉使徒的幻影，记录有摩根的日记，有人用异次元传走了狄瑞吉，留下的幻影导致了暗黑城瘟疫<ol>
<li>摩根记录还与伪装者有关，爱丽丝撒谎，爱丽丝转移话题指向使徒要一起打倒，暗夜精灵不信任爱丽丝了，这里有异次元裂缝</li>
<li>主要是爆舔组织是希洛克的遗留导致，这回又盯上了异次元的狄瑞吉，感受到了相同的气息，瘟疫感染也会变为伪装者，爆舔组织还打算从异次元中找到使徒奥兹玛</li>
<li>最终得知狄瑞吉转移到了诺斯玛尔，就是盗贼与变异地方</li>
<li>爱丽丝的解释有点道理，不过她有点粉切黑：人类脆弱，只有与暗精灵强大对手战斗才能强大最终与使徒一站，如果没有外敌，人类会自相残杀死亡</li>
</ol>
</li>
<li>远古:痛苦之村（主线）<ol>
<li>狄瑞吉真身在这里，从异次元空间过来的</li>
</ol>
</li>
</ol>
<h4 id="时间之门剧情"><a href="#时间之门剧情" class="headerlink" title="时间之门剧情"></a>时间之门剧情</h4><p>先是有人森林一把火，精灵最终为了继续守护结界牺牲，只剩下赛利亚，赛丽亚失忆了<br>索西雅（酒店老板）捡回了赛丽亚，他们是仅存的2个精灵<br>格兰之森BOSS牛头人最终提议去天空之城避难<br>诺伊佩拉（暗夜精灵的感染界）找到一个神秘女人，开启异界大门吸引的当时的异界BOSS，只取得一片衣服，去天界荒野继续调查</p>
<h4 id="世界观背景"><a href="#世界观背景" class="headerlink" title="世界观背景"></a>世界观背景</h4><p>神与使徒：神与恶，泰拉与阿拉德被毁，魔界与使徒诞生，使徒巴卡尔控制了天界，进攻了阿拉德，整体形成了灾难与大BOSS情况<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">有光明与邪恶，光明与伟大意志聚集诞生了神-卡罗索，邪恶在虚空中飘散</span><br><span class="line">有个高度发达的文明：泰拉人，泰拉科学家聚集了虚空邪恶力量，制造了12大战神，称作贝亚娜战神</span><br><span class="line">没想到12大战神内斗，同时神来讨伐导致泰拉星毁灭</span><br><span class="line">泰拉最大城市保留，不过最终在虚空中变为魔界</span><br><span class="line">12战神躯体毁灭，灵魂变化各异，最终变为了12使徒，有些使徒天生带有灾难，有一些则无害，他们最终聚集在魔界，目前还不够12个，具象化的只有几个，后面又因为恶诞生了新的使徒</span><br><span class="line">神也分裂为10个分身，守护者牺牲自己激活了神意志开始找分身，后寻找分身，在阿拉德找到迷之战士融合力量过于强大间接导致大转移灾难毁了阿拉德</span><br><span class="line">魔界没有光明因为使徒安哥拉一直在吸收能量，后另一个使徒卢克用泰拉石恢复了电力，照亮后巴卡尔发现了泰拉上石碑秘密，看到了所有使徒的死亡</span><br><span class="line">巴卡尔调查发现了第二使徒赫尔德的秘密计划：要聚集并牺牲全部使徒恢复泰拉星</span><br><span class="line">巴卡尔不想死，作为龙族老大，发起龙之战争，最终打不过第一使徒卡恩，但是泰拉也记录使徒杀死不了使徒，所以他成功逃脱</span><br><span class="line">巴卡尔通过寂静城次元裂缝逃离到天界，禁止天界使用魔法以免被赫尔德发现，天界发明科技力量，巴卡尔还封锁寂静城与天空之城，正好是阿拉德元年</span><br><span class="line">巴卡尔不但通知了天界，还派出3条龙到阿拉德</span><br></pre></td></tr></table></figure></p>
<p>人类故事：阿拉德的人类因为背叛诞生了2个使徒，诞生职业圣职者及转职，巴卡尔与赫尔德的斗争，最终巴卡尔死了，诞生了职业神枪手及转职<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">阿拉德卡赞与奥兹玛战胜一条龙，不过帝国担心陷害2人，让其自相残杀，然后2个人都被背叛流放</span><br><span class="line">奥兹玛接受邪恶变为混沌之神，成为新使徒，散播血之诅咒，变为伪装者，卡赞失去双手但怨念形成瘟疫，散播卡赞瘟疫</span><br><span class="line">五圣者都是教堂的人，最初的职业，通过宗教感受神谕、启示，修炼成为圣职者，米希尔最强，神格拳创始者，圣职可以近身攻击，他少年姿态，可以区分伪装者与人类</span><br><span class="line">五胜者另一个格拉西亚的信徒演化为圣职分支复仇者</span><br><span class="line">圣职者因为能识别伪装者，所以最终对奥兹玛发起了战争-暗黑圣战</span><br><span class="line">奥兹玛驱逐到异次元裂缝，当时大家都认为是米歇尔战胜的，但是米歇尔也从此消失不见。真像其实是爱丽丝封的，米歇尔也是被封印进去了，米歇尔最终被人们怀疑变为了一个使徒</span><br><span class="line">巴卡尔为了毁了赫尔德而培养天界，诞生了天界7战神，盖波加终极武器，后得知其中一人就是赫尔德变化，所有发展都来源于她的魔法，巴克尔觉得中计这样下去毁不了魔界，所以杀了7战神</span><br><span class="line">他目的一是铲除赫尔德党羽，而是为了引起天界人的公愤，让天界人更想推翻自己，激励后人科技发展以打倒使徒赫尔德的计划，真是用心良苦，7战神吧发明科技盖波加放到异次元中，等待后人挖掘</span><br><span class="line">不过巴卡尔没能达成锻炼天界人的愿望就死了，赫尔德最终目的还是希望使徒可以死，她收集能量，赫尔德利用时空裂缝传送了500年后的冒险家攻陷了巴卡尔，最终死不瞑目</span><br></pre></td></tr></table></figure></p>
<p>社会稳定与使徒威胁：合久必分，分久必合，最终形成了贝尔玛尔公国，赫顿玛尔也是阿拉德冒险者的核心地，但是使徒带来的灾难还在发生，冒险家这时候参与进来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">佩鲁斯帝国衰弱，国家内部战争无数，大贤者玛尔诞生，魔法牛逼，把沙漠变为绿洲，逃离战争的人，贝尔玛尔公国诞生，核心城市赫顿玛尔，珍惜和平中立国</span><br><span class="line">崇尚魔法莎兰负责，不过也重视科学，所以让诺顿负责炼金术，天界人凯丽来到了阿拉德，爱丽丝是魔法预言者</span><br><span class="line">其他地区-班图族，血色战役，因为冰龙侵占了他们的雪山领地，后来巴卡尔死了，所以冰龙也冬眠，班图族又回去了</span><br><span class="line">有更多的使徒来到了阿拉德大陆，导致了暗夜精灵地区的瘟疫，导致了诺伊佩拉的荒芜，被盗贼侵占，导致了GBL教徒被洗脑</span><br><span class="line">罗杰斯被GBL干掉封印</span><br><span class="line">悲鸣洞穴里，阿甘左与其他4剑圣来这里打希洛克，最终牺牲1人杀死了使徒</span><br><span class="line">天界由于赫尔德搞起了卡加德反抗军，掳走了天界公主</span><br><span class="line">黑色噩梦又是另外一个线索，导致了各种问题等待冒险家探索</span><br><span class="line">鬼手一直存在诞生了鬼剑士，卡赞的诅咒一直在，柔道家诞生保卫和平，魔法师是与魔界人魔法师xx脱离魔界后的因为签订过第四师徒召唤的协议放心让他们徒弟出来历练掌握魔法力量</span><br></pre></td></tr></table></figure></p>
<p>最新版本升级的剧情：层层面纱逐步揭开，目前巴卡尔、罗杰斯、希洛克、安图恩、卢克4个使徒都被干掉了，出场赫德尔、狄瑞吉、奥斯玛、米歇尔<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">次元裂缝的始作俑者发现是爱丽丝，爱丽丝被巴卡尔控制了，不过后来拜托了控制</span><br><span class="line">安图恩跑到了天界发电厂吸收能量，最终被冒险家干掉</span><br><span class="line">黑色噩梦的灾难找原因，黑色噩梦可以转移力量，打破次元世界，最终知道是使徒卢克制造的</span><br><span class="line">卢克有创造能力，后来来到魔界，第九使徒，他知道了死亡的语言，所以也在暗地反抗赫尔德反抗</span><br><span class="line">他创造寂静城，穿梭次元装置，寂静城其实就是为了自己吸收力量机器，吸收光恢复自身力量，希望能通过次元召唤以前的部下，贝奇拥有定位能力小女孩陪着卢克</span><br><span class="line">卢克比巴卡尔粗暴更智慧，制造了跟自己一样的机器人打算完成死亡使命</span><br><span class="line">最终成为众矢之的被赫尔德与阿拉德冒险一起攻击，寂静城失守，卢克被干掉，埋下伏笔巴恩吸收了卢克力量</span><br></pre></td></tr></table></figure></p>
<p>后续95版本：进攻到魔界，打普雷，第三使徒，鸟人<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">卡恩第一力量</span><br><span class="line">大转移后萝莉安被异次元裂缝带到了魔界，成为小红帽</span><br><span class="line">魔界曾经是泰拉里最繁华城市，变异，还有泰拉人，元素师，赫尔德最早</span><br><span class="line">魔法师来自与魔界，男法师角色就是佧修派的</span><br><span class="line">天界发生叛乱剧情</span><br><span class="line">看来主要就是讲述泰拉残余魔界的事情，还有泰拉石的伏笔，有组织控制，巴恩以后也是boss</span><br></pre></td></tr></table></figure></p>
<h4 id="平行世界设定"><a href="#平行世界设定" class="headerlink" title="平行世界设定"></a>平行世界设定</h4><p>时间轴衍生的世界：60级之前是镜像阿拉德，创世之后版本是真阿拉德，真阿拉德大转移的时候毁了，而60之前是在镜像阿拉德经历的，大转移还没毁，npc有的死有的活不太一样，2个时间同时存在</p>
<p>10个平行世界，通过深渊可以穿越遇到其他世界人</p>
<ol>
<li>大转移后的阿拉德</li>
<li>镜像阿拉德（时间轴之前的，主要给1-80级玩家升级用）</li>
<li>[混乱的世界]异次元世界</li>
<li>[恶魔的世界]异界虚空之境，恶魔世界</li>
<li>[使徒-巴卡尔的世界]龙界，巴卡尔获胜的，暴龙王，龙族统治，12使徒之一</li>
<li>[使徒-奥兹玛的世界]奥兹玛统治，伪装者，魔界人类结合，人心精神是最厉害的比物理征服厉害，引起内斗最终他赢了</li>
<li>[和平-泰拉恢复的世界]魔界，和平泰拉</li>
<li>[和平-和平世界]精灵和平世界，天界不行的世界</li>
<li>[无魔界的世界，人类内斗]魔界不在阿拉德，人类武器发达核弹毁灭，统治与组织战斗，4女子</li>
<li>[超能力世界，超级英雄]超能站联，dnf另一个平行世界游戏，超能者</li>
</ol>
<h4 id="使徒介绍"><a href="#使徒介绍" class="headerlink" title="使徒介绍"></a>使徒介绍</h4><p>官方原本计划天空之城后每一个副本关底boss都是一个使徒，后觉得使徒死的太简单，就改了剧本</p>
<ol>
<li>[原9][死]巴卡尔因为一位使徒心有灵犀去了魔界当使徒，本来傲慢的他就怕老大，了解到老大要恢复泰拉牺牲12使徒后造反，战败失去龙族去了天界，不魔法暴露，最终被天界人干掉，十篇章描述的男人（历史死）</li>
<li>[5][死]希洛克出场第一个使徒，被4剑圣干，夜精灵卡赞获胜死亡，使徒气息感染一帮人形成信仰（开场死）</li>
<li>[8][死]罗杰斯冬眠被逮到天帷巨兽，上天被gbl封印，最终干死，引出主题使徒一定是坏的么（天帷巨兽）</li>
<li>[6][死]狄瑞吉，瘟疫，不死之身，狗（暗黑城+诺斯玛尔）</li>
<li>[10][死]奥兹玛，法师，最初与卡赞帝国最强，最帝王陷害与卡赞自相残杀，混沌之神，血之诅咒，感染精神变为恶魔，伪装者，内部猜疑，有人借此铲除对方（异次元空间）</li>
<li>[11][死]米歇尔，圣职者近战蓝拳创造者，被当做使徒（异次元空间）</li>
<li>[7][死]安图恩，大乌龟，在天界发电站，吸收能源，塔尔坦族人共生（天界）</li>
<li>[9][死]卢克（寂静城，连接魔界）</li>
<li>[3][出现]鸟人，为了拯救族人流浪到魔界，有同卵双生，一正一邪（魔界，中央公园）</li>
<li>[2][出现]泰拉科学家，魔法，赫尔德，魔界指挥者，为了复活泰拉，泰拉的创新世界第一章与第四章拥有，策划转移，异变</li>
<li>[4]卡西利亚斯，好战，为了与阿拉德怪物战斗，找到最强召唤师签订契约，其他召唤师也可以召唤，觉醒技能，战斗能力强</li>
<li>[1]卡恩，能力最强</li>
<li>[12]使徒未知？知晓一切？赛利亚？</li>
</ol>
<h4 id="职业"><a href="#职业" class="headerlink" title="职业"></a>职业</h4><p>鬼剑士（鬼手）:剑魂（手速，单挑），鬼泣（buff，召唤），阿修罗（魔法师，远距离，输出），狂战（用红输出，本职），故事在开场<br>漫游（快，手速，单挑），枪炮师（远距离），弹药专家（子弹与手雷，本职），机械师（召唤），故事主要在天界<br>元素师（最强，配合神器最强，爱丽丝最强），战斗法师（单挑也最强，尼屋），召唤师（太慢），魔道学者<br>魔枪士，枪剑士，守护者，缔造者，暗夜xx这么多新职业，还没试过手感与剧情</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这是一部故事完整，操作手感非常好的横版过关游戏，过去玩手感，现在玩剧情<br>不过玩到后期就是按一遍技能的节奏，手感已无，无外挂不充钱刷图困难<br>毕业的步骤：玩完剧情，最终就是刷装备了，刷完一整套满级装备就算是毕业了，然后换个角色体验下，然后等官方新版本推出<br>这个作为网游很成功，充钱地方很多，需要充钱买时装买复活币，尤其是每年各个节日的时候各种节日套装买买买<br>没有一起玩的人的时候完全可以当做单机游戏玩，不过当时这么热爱这块游戏应该主要还是因为能与朋友们一起刷图的快乐吧，DNF下个十年再见！</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;高中玩过的最好玩的网友：DNF，10年过去了，现在又想重温总结下&lt;/p&gt;
&lt;p&gt;但是这是个超级耗时间的游戏，腾讯的游戏还耗费金钱，所以找到了私服or单机版的玩了玩，做完了所有主线与支线任务花了1周左右，也完整了体验到了最新的剧情&lt;/p&gt;
&lt;p&gt;其实以前是很少关注剧情的，做任
    
    </summary>
    
      <category term="娱乐" scheme="https://dawell.github.io/categories/%E5%A8%B1%E4%B9%90/"/>
    
    
      <category term="游戏" scheme="https://dawell.github.io/tags/%E6%B8%B8%E6%88%8F/"/>
    
      <category term="DNF" scheme="https://dawell.github.io/tags/DNF/"/>
    
  </entry>
  
  <entry>
    <title>日本旅游</title>
    <link href="https://dawell.github.io/2018/09/22/%E6%97%A5%E6%9C%AC%E6%97%85%E6%B8%B8/"/>
    <id>https://dawell.github.io/2018/09/22/日本旅游/</id>
    <published>2018-09-22T06:09:00.000Z</published>
    <updated>2018-11-25T10:39:33.118Z</updated>
    
    <content type="html"><![CDATA[<p>8月31日，终于踏上去日本的旅程了，在去往机场的路上，有些小兴奋~<br>小时候喜欢看动漫，喜欢玩游戏，所以冲着对二次元的爱好一直想着也该去一次日本吧，再加上大家都说日本适合旅游，就更加想去了<br>其实在12年左右因为公司支持原因有几次去日本的机会，不过当时各种阴差阳错都错过了，这次终于可以去成了，也算是满足一个小的愿望…</p>
<p><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa3jw87n0j22bc3341kz.jpg" alt="启程"></p>
<h3 id="计划不如变化"><a href="#计划不如变化" class="headerlink" title="计划不如变化"></a>计划不如变化</h3><p>这次是与同事公司outing的形式出来玩的，10人成团，虽然是同事，不过大部分人是其他团队的都不大熟，主要是与我们产品结伴而行<br>整体上这次去日本的计划是这样的：杭州，大阪，奈良，京都*2，大阪，杭州，一共玩4天左右，不过最后1天来了个刺激的台风打乱了返程计划，最终变成7天=。=<br>最后增加的3天，基本没怎么玩，把大阪剩余的地方逛了逛，冈山路过回家心切没怎么玩就去机场了<br>体验可以说是比较完整了，半深度游，有世界文化遗产、古城、寺庙、山林、市场与台风，吃吃吃，买买买，逛逛逛，前期略赶，后期略闲</p>
<h3 id="衣服"><a href="#衣服" class="headerlink" title="衣服"></a>衣服</h3><p>虽然日本的酒店里都配有烘干机，不过也只适合洗洗小件的内衣袜子之类的，旅行大件衣服只能拿到专门的洗衣房去洗，有的旅馆配备就比较方便<br>大部分情况都是一天玩完都累得要死，回去只想洗澡睡觉了<br>所以多带了几套换洗衣服备用，虽然天气刚好，不过为了以防万一备用了眼罩与一件外套，这次露宿机场就用上了，真是亏了这次准备的齐全，不过我的行李箱一半都是衣服<br>路上会碰到穿和服的妹子，这个也就是拍拍照吧，自己带妹子可以穿上拍拍照</p>
<h3 id="饮食"><a href="#饮食" class="headerlink" title="饮食"></a>饮食</h3><p>日本有很多的便利店，全家最多，其次罗森、7eleven，我才知道全家是日本的，还以为是北上广发展的呢，便利店买点早餐，水，奶之类的还是方便的<br>不过来了日本当然是吃这里的特色了，不去便利店吃午餐与晚餐，日本的特色饮食基本上就是拉面、盖饭、烧烤、寿司、海鲜之类的，这几天吃了个遍<br>天天下馆子，一顿饭的价格一般不低于1000日元，也就是60-100元的样子，日本的街上很少像国内还能消费到特别便宜饮食，基本想便宜吃的就只能去便利店吃了<br>不管是面还是饭还是肉，反正日本的饮食几乎没有菜没有水果，毕竟成本高，所以低端的饭就是主食+酱料or配料，而高端点的就+各种炸烤腌的肉，虽然好吃，但是不太健康<br>日本的饭上面上一般都会有半熟的鸡蛋，日文”温玉”，鸡蛋感觉在各种美食中都不可缺少。饮食注重颜色搭配，绿色主要靠葱花装饰，而且注重酱料与汤汁，酱料丰富，而汤汁浓郁算是对日本饮食的印象吧</p>
<p>发现日本的生鲜文化，各种生吃的食物确实新鲜，不过我还不能适应，螃蟹、鱼肉倒是让我想起了国内的盒马鲜生这类产品，不过国内不仅是吃的新鲜还是做熟了吃的，想吃鲜还是熟的比较好</p>
<p>随便发点吃过的照片<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa9ic876nj23342bc4qs.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa9kqw15rj23342bce83.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa9l6yznlj23342bc7wk.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa9li56cxj22bc334x6r.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa9lusckwj23342bc4qs.jpg" alt=""></p>
<h3 id="住宿"><a href="#住宿" class="headerlink" title="住宿"></a>住宿</h3><p>酒店价格时高时低，一般2个人订酒店可以订到400-1000之间的酒店，台风那天涨到850，之前差不多是650，而后面找酒店找到550的，而同事订的还有450的，都还不错，所以完全看能否找到便宜的酒店，平摊下来一个人300左右还不贵<br>这个价格预定的酒店不带水，早上也不含早餐，所以一般自己便利店解决更划算点<br>除了预定酒店，一个人可以住胶囊公寓，听同事反馈也很独特的体验，还可以使用资生堂全套化妆品，一个人也是300元左右<br>还有就是民宿的方式，民宿就便宜很多了，有的一晚上才100多元，不过很多没有空调或者独立卧室，与其他人一起住，同事住的有的被蚊子咬，不过可以体验传统榻榻米与日本住宅风格，独特的体验，一般用爱彼迎订</p>
<p>除了周六周日酒店的价格都还好</p>
<h3 id="出行"><a href="#出行" class="headerlink" title="出行"></a>出行</h3><p>这次日本体验的交通挺全的，飞机场、火车、大巴、地铁、新干线、公交，就没有体验打的与坐船了</p>
<p>日本的交通很发达，地上铁很多，地铁也很复杂，去哪里都方便，跨城市可以做新干线，有300km/h的速度，关西的IC卡实在是方便，基本地上铁与地铁一卡通，而且多家铁路公司都是可以消费的<br>JR是日本的国铁，修建的铁路最多，其他公司也修建了很多铁路，所以有时候一个地方有多个重名的站点，不过会带着前缀标识不同的铁路公司，比如可以看看6个难波地铁站的介绍</p>
<p>大阪有2个机场，不过只有关西机场是国际机场，另一个只有国内航班，隔壁的神户也只有一个国内航班，所以关西机场挂了后，我们这次只能去较远的左冈山，或者右名古屋机场是最近的机场了<br>刚从关西机场下来后还要做个铁路到城市感觉还挺新颖的，不过台风导致船闯了连接桥就发现这样设计挺愚蠢的，在软件架构里这就是单点故障呀，至少修建2条连接桥backup下还差不多<br>飞机日本全日空是不错的，吉祥航班也可以，不过这次台风来了，吉祥的提早取消给安排了其他航班，而我们最后取消安排的很晚，比我们更加幸运一些</p>
<p>在车站买大巴票时最好用自动售票机买，以后可以退掉，而窗口买的是无法退票的，大巴的行李有专人安排并放到车上从车拿下，服务态度挺好的</p>
<p><img src="http://ww1.sinaimg.cn/mw690/712a7015gy1fwa3nvmgr9j23342bc4qr.jpg" alt="IC卡"></p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>支付：之前去过泰国，本以为日本也是支付宝微信的天下，其实日本大多还是用现金支付，信用卡也支持比较多，而支付宝微信只有不多的几家支持。不过自动化程度也挺高的，自动投币找零的机器到处都是，如拉面馆、章鱼小丸子的小摊、车站，基本都是大家自己投币找零，虽然不支持支付宝微信，但是也是比较高效方便的，就是口袋里一大堆硬币<br>记账：使用了挖财记账软件，记录日币消费发现是人民币符号，后来才知道日元与人民币的符号确实是一样的都是￥，所以不是软件的bug<br>网络：可以随身wifi携带，不过并不方便，如果开漫游很贵，我用的小米手机有全球上网服务，会虚拟一张本地卡，可以选择使用天数占用一个卡位，还是不错的一天12块钱还有优惠，网速不错，而且可以上youtube之类的网站</p>
<h3 id="日本特点"><a href="#日本特点" class="headerlink" title="日本特点"></a>日本特点</h3><p>化妆：女性的腮红很夸张，不管好看不好看的都化妆<br>雨伞：用的都是透明长伞，并非折叠伞<br>出租车：出租车的司机大多是老头，难道是为了解决老龄化问题？而车子都是黑色统一样子，感觉非常绅士讲究<br>车辆：大多是日本国产车，丰田，雷克萨斯，德系车不多，偶尔看到奔驰车。日本的车都很干净，尤其是夜景各个都反光，可能空气与城市都干净的原因<br>信仰：日本人同时信仰2种神：一个是佛教，中国传进来的，一个是日本自己的神名，所以可以看到很多祭拜的地方一种是佛教的寺庙，一般都有金色灰色，一种就是门口有鸟居的寺堂，一般都是红白色</p>
<h3 id="回忆经历"><a href="#回忆经历" class="headerlink" title="回忆经历"></a>回忆经历</h3><h4 id="第一天路线-奈良：小鹿公园、东大寺、春日大社、JR站门口的商业街、道顿崛、心斋桥"><a href="#第一天路线-奈良：小鹿公园、东大寺、春日大社、JR站门口的商业街、道顿崛、心斋桥" class="headerlink" title="第一天路线-奈良：小鹿公园、东大寺、春日大社、JR站门口的商业街、道顿崛、心斋桥"></a>第一天路线-奈良：小鹿公园、东大寺、春日大社、JR站门口的商业街、道顿崛、心斋桥</h4><p>一大早做JR环装倒车奈良高铁过去，路上就碰到了各种鹿，然后经过博物馆走向东大寺，旁边有卖150日元的喂鹿的饼干，鹿会盯着你的袋子，不给食物会咬你撞你跟着你，尤其是东大寺前面那群，带着角的还挺害怕的，不带角的可以调戏调戏，鹿跟你点头意思就是要吃的，还是挺可爱的<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa3yiksdrj23342bc4qx.jpg" alt="小鹿" title="小鹿"></p>
<p>东大寺确实够大，是我见过最大的佛像，而且寺庙建筑更大，还是非常震撼的，旁边还有一些小点的寺庙，不过里面也是收费的就没去看<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa3zaunx2j23342bce84.jpg" alt="东大寺" title="东大寺"></p>
<p>春日大社是日本的神教，里面有32个祠堂可以祭拜，每个神保佑的东西不一样，红白对比度很高很艳丽，是挺适合拍照的<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa3vyr8yhj23342bckjq.jpg" alt="去春日大社路上" title="去春日大社路上"></p>
<p>意外：春日大社那边走到导数第二个祠堂时突然从天上掉下来了一大段树干，我倒是没事，不过我同事受伤了，划破了头皮，后来被送到医院缝了3针然后管理人给了全额赔付，这个体检就不展开了，只能提醒大家要注意安全，而且记得买保险<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa408wjzkj23342bcb2e.jpg" alt="意外" title="意外"></p>
<p>总体上奈良第一天的体验非常的好，虽然出了一些意外，但是整体感觉就是小清新，而且那天是下雨过后来了大片森林中，感觉格外的好，如果正常进度，大约下午2点来钟就能玩完这3个景点，随后是返程，回JR时路过了商业街吃饭与买东西一把</p>
<p>回到大阪：由于中间的意外，回去正好是晚上了，从难波去了道顿崛，再到心斋桥，基本上这3个连在一起的，就是一路向北大致逛了下，人是超级多，而各种药妆店与购物点也是超级多，不过我对购物欲望不大，主要是看看各种名场景吧<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa43lj6x7j23342bcb2c.jpg" alt="道顿崛" title="道顿崛"><br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa42yg5bej23342bcb2c.jpg" alt="心斋桥" title="心斋桥"></p>
<h4 id="第二天路线-京都：伏见、三十三间堂、清水寺、三连板二连板、祇园、花见小路、八坂神社、鸭川"><a href="#第二天路线-京都：伏见、三十三间堂、清水寺、三连板二连板、祇园、花见小路、八坂神社、鸭川" class="headerlink" title="第二天路线-京都：伏见、三十三间堂、清水寺、三连板二连板、祇园、花见小路、八坂神社、鸭川"></a>第二天路线-京都：伏见、三十三间堂、清水寺、三连板二连板、祇园、花见小路、八坂神社、鸭川</h4><p>一早我们做上去京都的高速火车出发了，那班火车特别点出了IC卡入站后坐上车后还需要买票，为了能到了就玩我们轻装上阵，行李箱放在了同事那边，第一站是伏见，千本鸟居地，一路爬山，我们按照最远最长路线攀爬体验了一把完整的千本鸟居，分为好几个阶段，整个路程从上山到下山花了一上午时间，在鸟居上阳光下来的一瞬间是特别美的，各种拍照，不过一路都在想做这么多鸟居要砍多少木头呀…<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa4qqrpt8j23342bckjn.jpg" alt="伏见" title="伏见"><br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa9mquj1sj23342bcu12.jpg" alt="祈愿牌" title="祈愿牌"></p>
<p>我们中午在附近吃了顿拉面，然后看了下路过火车的临时拦截与路灯的场景，想到了秒速五厘米与创越时空的少女的动画，甚是感动</p>
<p>然后一路向北，第一站是三十三间堂，里面不允许拍照，光脚丫进，也是比较震撼，一千座佛像，还有千手观音，感觉就和兵马俑一样，数量多而且神圣，前面还站着天龙八部神仙，武器各种不同，火影中阿修罗的原型就是采用这里面的<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa4q49z8ej23342bchdv.jpg" alt="三十三间堂外景" title="三十三间堂外景"></p>
<p>再往北一些就到了清水寺，进去逛了一圈，不过最大的地方在装修，拍不到名场景，上面还有个求姻缘的地方，2个石头闭着眼从一个摸到另一个就有姻缘上的好运，让同事搞了一遍，然后一圈后下来了<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa4pr5tubj25fw1u3hdz.jpg" alt="清水寺" title="清水寺"></p>
<p>然后又是购物买买买的地方，这里有处抹茶搞点不错买了点，然后三连板二连板路过祇园，走到花见小路商业街，再走到鸭川，刚到鸭川感觉也没什么，不过夜景就很好了，所以晚上再来，我们去了酒店checkin<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa4rrbml4j22bc334b2d.jpg" alt="二连板" title="二连板"></p>
<p>酒店整理好去了去了夜景的八坂神社各种拍照，地方不大，这里吃到一家超级棒的拉面馆，然后又去鸭川待了一晚上，有个妹子一直在旁边唱歌，挺好听的，鸭川坐着的大多是小情侣亲亲我我的，看来是个调情的好地方<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa4o6e9r8j23342bcnpg.jpg" alt="八坂神社" title="八坂神社"><br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa4ovu2avj23342bcu0y.jpg" alt="鸭川" title="鸭川"><br>总体上这一天稍微累了点爬山多景点多，但是很满足，而且最终在鸭川听着歌吹着风休息了好久，很舒服，今天把京都我最想去的几个地方玩了</p>
<h4 id="第三天路线-京都：金阁寺、天龙寺、二条城、锦市场、大阪：友都八喜、蓝天大厦空中花园"><a href="#第三天路线-京都：金阁寺、天龙寺、二条城、锦市场、大阪：友都八喜、蓝天大厦空中花园" class="headerlink" title="第三天路线-京都：金阁寺、天龙寺、二条城、锦市场、大阪：友都八喜、蓝天大厦空中花园"></a>第三天路线-京都：金阁寺、天龙寺、二条城、锦市场、大阪：友都八喜、蓝天大厦空中花园</h4><p>一大早我们做公交一路赶到金阁寺，金阁寺的名票特别有意思，一进去就可以找到拍照的最佳位置，同时被金阁寺金灿灿的风景震撼一把，不过再往里走发现就没啥意思了，普通的花花草草<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa7g75vbzj23342bcb2d.jpg" alt="金阁寺" title="金阁寺"></p>
<p>紧接着走到了里金阁寺不远的天龙寺，天龙寺听说还是乔布斯特别喜欢的寺庙，当时商业失败郁闷的时候就是来这里修身养性的，然后回苹果搞出了iphone，金龙寺最有名的是枯水庭院设计，大致参观了下，一共15块石头，从哪个方向都只能最多看到14块，比较特别<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa7gw445nj23342bc7wm.jpg" alt="天龙寺" title="天龙寺"></p>
<p>中午就在天龙寺里的一家豆腐店吃了，最有名的是豆腐，不过这里最喜欢的还是布局与风景<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa7hbbu9mj23342bcx6r.jpg" alt="天龙寺豆腐店" title="天龙寺豆腐店"></p>
<p>吃完公交车去了二条城，二条城是德川家族居住的地方，整个城很大，有各种房间，接待宾客的，卧室，其中一间卧室的墙壁上还绘有西湖名胜，倍感亲切<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa7i3zoycj23342bcb2d.jpg" alt="二条城护城河" title="二条城护城河"></p>
<p>二条城出来一路向东，来到著名的锦市场，唯一的感觉是日本的蔬菜水果真心贵，10倍有余</p>
<p>晚上来到酒店附近的大商场友都八喜，从地下一楼逛到顶楼，地下一楼简直是动漫游戏天堂，各种手办模型游戏电影漫画都能在这里买到，东西齐全，发现儿童玩具也是超级多<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa7ihptrpj23342bcu0z.jpg" alt="友都八喜" title="友都八喜"></p>
<p>最终在友都八喜顶楼碰到同事们一起吃了著名的铁板烧，国内也看到过这种日本料理店，这次吃个正宗的</p>
<p>吃完饭，也没有回酒店，赶上去附近的蓝天大厦空中花园看看，一路升到最高层，没想到最高层的房顶也可以上去，视野很宽广，在上面静静地看着这座城市结束这一天的行程<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa7ixamugj23342bc7wj.jpg" alt="蓝天大厦顶层" title="蓝天大厦顶层"></p>
<h4 id="第四条路线-大阪：大阪城公园、BIC、道顿崛、吃饭问题"><a href="#第四条路线-大阪：大阪城公园、BIC、道顿崛、吃饭问题" class="headerlink" title="第四条路线-大阪：大阪城公园、BIC、道顿崛、吃饭问题"></a>第四条路线-大阪：大阪城公园、BIC、道顿崛、吃饭问题</h4><p>最后一天的行程，我们就差大阪的名景点了，大早上的我们赶到了大阪城公园，等到9点开放买门票，不过广播公告由于天气影响不开放了，郁闷，只能在公园里逛了下，随后我们就收到了航班取消的通知，领队同事在联系更换航班，于是我们接着玩了下<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa8lom83dj23342bcx6r.jpg" alt="大阪城" title="大阪城"></p>
<p>先是赶到了BIC购物商场，看了看比友都八喜要小点，中途还碰到了代购，与一帮中国人疯狂抢购保温杯</p>
<p>心斋桥又去代购一番，中午在道顿崛吃了回转寿司，进去的时候下大雨，出来的时候就已经是狂风暴雨了，还看到了在说明天气情况电视台的人<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa8mkti91j23342bcqv8.jpg" alt="电视台采访台风" title="电视台采访台风"></p>
<p>发现地铁口都被封了，我们只能走到心斋桥附近的商场里，出口全是狂风，看到了吹倒的大树与马上上乱七八糟的物品，只能困在商场里了，很多店今天也是关门了，不过为了等台风过去还是随便逛了逛，台风小点的时候，出去找到大的地铁站南波站然后直接坐回了家<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa8wopjp0j21hc0u0adt.jpg" alt="台风" title="台风"></p>
<p>回旅馆休息了下，看了会日本的电视节目，不过目前报道的全是台风新闻，路上的时候就听同事说关西国际机场出事了，不过并不以为然，回到酒店发现各大频道都在播放关西机场的情况，竟然真的出问题了，一艘船把关西机场与大陆唯一的连接桥的撞了<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa8xjuedwj23342bcqv6.jpg" alt="电视台" title="电视台"></p>
<p>这时候出来玩的同事群里已经炸了，大家都在讨论机场是否可以修好，我们机票是否可以更换，不过带头的同事说是要等到第二天上午让全日空给更换机场，机场调换的话是免费的，有2个同事比较着急就当天买了名古屋的机票</p>
<p>晚上出去已经没风了，感觉与平日的行人差不多，找了好远才找到一家不错的店解决了温饱问题，晚上续订了酒店，酒店价格因为台风瞬间就涨了300，没办法只能继续订</p>
<h4 id="第五天路线-大阪：商量回去、书店、道顿崛、心斋桥、日本桥动漫街"><a href="#第五天路线-大阪：商量回去、书店、道顿崛、心斋桥、日本桥动漫街" class="headerlink" title="第五天路线-大阪：商量回去、书店、道顿崛、心斋桥、日本桥动漫街"></a>第五天路线-大阪：商量回去、书店、道顿崛、心斋桥、日本桥动漫街</h4><p>早上起来ANA说给安排换机，不过要等很久，我们也按捺不住了，我与我们产品买了从冈山出发的机票，剩余很多城市买了从福冈出发的机票，他们还打算去福冈玩玩</p>
<p>到了下午收到通知，我们产品跟领队被航空公司调整好了，其他人估计要调整到13号，太晚，这样我们就商量分开返回国</p>
<p>晚上预定了心斋桥附近的宾馆，过去落脚后，晚上赶到了日本街二次元天地逛了逛，不过去的有点晚，剩余的几家店看了看，发现日本真的是各种娃娃机，连手办都有，还有就是手办各种贵，因为都是正版货，简单看了看<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa91plks4j23342bckjn.jpg" alt="日本桥animate" title="日本桥animate"><br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa916du61j23342bcb2c.jpg" alt="日本桥" title="日本桥"></p>
<p>在心斋桥大丸百货又帮家人代购了一把</p>
<h4 id="最终2天-冈山：懒床休息、新干线、桃太郎、上海磁悬浮"><a href="#最终2天-冈山：懒床休息、新干线、桃太郎、上海磁悬浮" class="headerlink" title="最终2天-冈山：懒床休息、新干线、桃太郎、上海磁悬浮"></a>最终2天-冈山：懒床休息、新干线、桃太郎、上海磁悬浮</h4><p>早上与产品告别，我一个人踏上行程，虽然是第二天的才从机场出发，不过担心过程中有什么问题，中午就从大阪赶到冈山去了，这次路上又体验了一把日本的新干线，一路到达冈山</p>
<p>下车第一件事情是导航，不过时间还比较多，还打算去逛下，看到了桃太郎的雕像，这里也有故事，对面虽然是大商场，不过保险起见我先去买了汽车票<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa92yllicj22bc334u10.jpg" alt="桃太郎" title="桃太郎"></p>
<p>买汽车票的时候遇到了一行人买票困难，帮助了下，然后又来了一个会日语的妹子，发现都是因为关西机场原因来到这里，并且订的都是同一趟车</p>
<p>我们都搜了下附近酒店与民宿，价格都超高，于是妹子提议直接去机场过夜，而刚那一行人还行去打听下酒店的情况自己出发了，妹子没网，靠我开的热点，她提议现在就去机场，她会日语感觉方便点，就跟着去了一趟机场</p>
<p>去了一看是个小机场，沟通了一把，说是冈山晚上不允许逗留，要关门，不过好在妹子日语不错，沟通了一把，说是关西机场的难民，于是允许了逗留一晚，随后就看到很多中国人陆陆续续都来到了机场</p>
<p>机场里有个咖啡厅，有充电的地方，也有网，我们就在那边呆了很久，然后在机场里的餐馆饱餐了一顿</p>
<p>晚上本以为要躺在凳子上睡了，不过机场管事的日本人与保安推来了一大车毯子，给我们一人发了一床，然后在机场排队处铺了一些地铺，我看了直接上去帮忙，最终很多人都是在地铺中睡了一觉<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa93uwb18j23342bce83.jpg" alt="冈山机场" title="冈山机场"><br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa94hi8o0j23342bckjn.jpg" alt="冈山机场" title="冈山机场"></p>
<p>第二天早上我们验过行李，然后登机返回了上海</p>
<p>在上海等行李等了半小时多，吐槽，然后又体验了一把上海浦东机场磁悬浮，可以直达公司附近，速度还不错，轨道比较刺激都是斜着的</p>
<h3 id="购物"><a href="#购物" class="headerlink" title="购物"></a>购物</h3><p>药妆店：超级多，都有中文导购，像是给中国人开的<br>专柜：专柜买的人也很多，不知道为啥，有的比国内都要贵<br>代购的疯狂：路上带着行李箱逛游的几乎都是代购</p>
<h3 id="二次元文化"><a href="#二次元文化" class="headerlink" title="二次元文化"></a>二次元文化</h3><p>游戏机厅真的不少<br>动漫电玩店<br>漫画店</p>
<h3 id="费用"><a href="#费用" class="headerlink" title="费用"></a>费用</h3><p>除了额外花的：帽子、手办、小饰品、化妆品等给自己买的东西外<br>费用的话还是挺省的，如果是原计划应该在7000左右，不过多增加的3天费用增加3000左右，所以最终花了1w左右<br>这7天大头是交通费一共花了4500元，住宿花了2000，吃喝花了1400，购物花了2200，不过有800是帮其他人代购的，自己花了1400，其中1000多都是给同事家人带的吃的<br>最初预定的ANA的机票来回2400，属于比较便宜的特价票了，而住宿4天双人合租平摊1300元，所以住行大头才3700元，整体成本不高，后来台风来了航班取消，机票价格都涨了不少，机票变为2000，多住宿3天（最后一天睡了机场），剩余都是日本国内交通费用了<br>虽然是花了1w，不过因为航班延误是可以保险理赔的，最终赔付了2k，所以算下来整个旅程花了8k左右，真的是很便宜了</p>
<h3 id="保险"><a href="#保险" class="headerlink" title="保险"></a>保险</h3><p>出国旅游保险是很有必要的，一个是在国外受伤或者住院的费用可以报销，还有就是飞机航班延误与取消会进行金额赔付，后者是大概率事件，尤其是日本动不动就地震台风的，所以保险非常必要<br>这次因为台风导致的延期3天的行程所有的住宿与交通费用由于买了报销都可以报销，而且公司人文关怀了下多给了3天outing假期，所以相当于免费多玩了3天，这种意外幸亏也不会产生额外的损失，保险费才几十块非常值<br>同事有的买的小额的20元的保险因为航班取消都赔付了1k元</p>
<p>台风是真的够猛的，当时恰好去过2次的蓝田，对比图如下<br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa9zpgu6mj22bc334hdv.jpg" alt="" title="台风前"><br><img src="http://ww1.sinaimg.cn/mw690/712a7015ly1fwa9zekjbgj22bc334x6r.jpg" alt="" title="台风后"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>整个过程真的是非常难忘，赶上台风，听说北海道又发生了地震，好多关西机场的难民还想去北海道回国，看来他们是最倒霉的一批人了<br>日本多灾多难食物匮乏不适合生活，台风、地震、核辐射、青菜水果贵的要死，容易得胃肠病，怪不得日本的保险业很发达，感觉多灾多难也是一个原因<br>但是适合旅游，倒不是特别喜欢日本的饮食、购物与普通的景点，但是日本很干净，有更多的樱花树，独特的和风体验，二次元天堂，如果不去安排特别满的行程，不去购物，只看下特别的景点，去泡泡温泉慢下来欣赏这个城市也许才是最享受的<br>最后公司员工关怀因为台风原因多给了3天outing假期，不用扣假期了，贴心~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;8月31日，终于踏上去日本的旅程了，在去往机场的路上，有些小兴奋~&lt;br&gt;小时候喜欢看动漫，喜欢玩游戏，所以冲着对二次元的爱好一直想着也该去一次日本吧，再加上大家都说日本适合旅游，就更加想去了&lt;br&gt;其实在12年左右因为公司支持原因有几次去日本的机会，不过当时各种阴差阳错都
    
    </summary>
    
      <category term="娱乐" scheme="https://dawell.github.io/categories/%E5%A8%B1%E4%B9%90/"/>
    
    
      <category term="旅游" scheme="https://dawell.github.io/tags/%E6%97%85%E6%B8%B8/"/>
    
      <category term="日本" scheme="https://dawell.github.io/tags/%E6%97%A5%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>云栖大会2018一日游</title>
    <link href="https://dawell.github.io/2018/09/21/%E4%BA%91%E6%A0%96%E5%A4%A7%E4%BC%9A2018%E4%B8%80%E6%97%A5%E6%B8%B8/"/>
    <id>https://dawell.github.io/2018/09/21/云栖大会2018一日游/</id>
    <published>2018-09-21T08:11:18.000Z</published>
    <updated>2018-10-16T11:15:20.781Z</updated>
    
    <content type="html"><![CDATA[<p>云栖大会是阿里组织的包含了最新的行业动态与技术分享的大会，每年一次，今年是第8次<br>往年真是关注技术分享，都是看在线直播，不过离杭州这么近，为啥不去亲身体验一把呢？于是这次请了一天假过去参加</p>
<p>整个大会持续4天，分为主会场与分会场还有一些音乐节之类的活动，看了下大会行程，只有开发者专场比较感兴趣，所以这次目标明确的想去E会场看看<br>票务有VIP票与普通票，有4天的票也有只参加1天的票，很早就关注的，阿里云还给我发了优惠券，所以买了第二天的早鸟票90多元<br>云栖大会前几天发来短信提示需要用钉钉才能取到票二维码，看来阿里是无处不安利钉钉，钉钉里还需要人脸识别录入</p>
<p>早上与同事打车过去，听说路上会堵，所以7点多就出发了，途径各种隧道到达云溪小镇（途中隧道有2条路径，导航指示往左走，但是有个很大的牌子指示云栖大会向右走，问了司机才知道，往右其实要绕远路，这样做得目的是为了分流，Get！）<br>我们从南门进，进去先到A座大楼前验票，先二维码验票，然后第二道关卡需要验证之前录入的人脸，感觉还是很有科技感的，拿了份大会的地图</p>
<p><img src="http://ww1.sinaimg.cn/large/712a7015ly1fvh96g4zdrj23342bcx6r.jpg" alt="地图"></p>
<p>C座看上去还是挺有艺术感的，楼上是塑胶跑道，还放着一个aliyun的热气球</p>
<p>先在B馆逛了下</p>
<p>待续。。。</p>
<h3 id="赠品"><a href="#赠品" class="headerlink" title="赠品"></a>赠品</h3><p>勋章，冒充的勋章<br>布袋子，塑料袋子，茶叶，鸡蛋，糖，便利贴，笔，悠悠球，玩偶手办，洁屏指，雨伞，鼠标垫，文件夹，烟盒，抹布，饮料，水，贴画</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;云栖大会是阿里组织的包含了最新的行业动态与技术分享的大会，每年一次，今年是第8次&lt;br&gt;往年真是关注技术分享，都是看在线直播，不过离杭州这么近，为啥不去亲身体验一把呢？于是这次请了一天假过去参加&lt;/p&gt;
&lt;p&gt;整个大会持续4天，分为主会场与分会场还有一些音乐节之类的活动，看
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Dubbo生态</title>
    <link href="https://dawell.github.io/2018/09/01/Dubbo%E7%94%9F%E6%80%81/"/>
    <id>https://dawell.github.io/2018/09/01/Dubbo生态/</id>
    <published>2018-09-01T02:40:32.000Z</published>
    <updated>2018-08-15T03:04:51.484Z</updated>
    
    <content type="html"><![CDATA[<p>Dubbo圈子最近也开源了各种产品，公司也主要以dubbo为主的微服务生态建设，而且也是自己从14年使用dubbo也做个总结</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Dubbo圈子最近也开源了各种产品，公司也主要以dubbo为主的微服务生态建设，而且也是自己从14年使用dubbo也做个总结&lt;/p&gt;

    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>剑的传说</title>
    <link href="https://dawell.github.io/2018/08/22/%E5%89%91%E7%9A%84%E4%BC%A0%E8%AF%B4/"/>
    <id>https://dawell.github.io/2018/08/22/剑的传说/</id>
    <published>2018-08-22T13:16:05.000Z</published>
    <updated>2018-11-25T10:34:32.789Z</updated>
    
    <content type="html"><![CDATA[<p>总结下各种剑的传说吧，他们的游戏系列，电视剧情况，网游情况，评分与推荐，剧情与特色<br>中国游戏改编的古装剧是很有特色的，基本都与剑有关，拍一部火一部<br>传统单机三剑是：轩辕剑、仙剑、剑侠情缘，不过剑侠情缘感觉后续剧情上不怎么火，也没怎么玩过</p>
<p>这里介绍的有基本有这么几部</p>
<ol>
<li>轩辕剑</li>
<li>仙剑</li>
<li>古剑奇谭</li>
<li>诛仙</li>
</ol>
<h2 id="轩辕剑"><a href="#轩辕剑" class="headerlink" title="轩辕剑"></a>轩辕剑</h2><p>轩辕剑第一部作品诞生在1991年，到现在已经27岁了，国产单机系列三剑之一，由台湾大宇的DOMO工作室研发的RPC单机游戏</p>
<h3 id="作品"><a href="#作品" class="headerlink" title="作品"></a>作品</h3><p>首先回顾下历史朝代顺序：夏、<strong>商</strong>、<strong>西周</strong>、东周、<strong>春秋</strong>、<strong>战国</strong>、<strong>秦</strong>、<strong>汉</strong>、<strong>三国</strong>、<em>晋</em>、南北朝、<em>隋</em>、<strong>唐</strong>、宋、元、明、清<br>黑色的是轩辕剑涉及到的朝代，斜体是稍有交集</p>
<p>单机作品</p>
<ol>
<li>轩辕剑1</li>
<li>轩辕剑2、轩辕剑2外传枫之舞-战国</li>
<li>轩辕剑3云和山的彼端-隋唐朝西方世界、轩辕剑3外传天之痕-隋唐</li>
<li>轩辕剑4黑龙舞兮云飞扬-战国秦朝、轩辕剑4外传苍之涛春秋晋朝秦朝<ol>
<li>苍之涛跟进司马光资治通鉴按时间顺序写的，往前10年，往后10年，时间表，事件。史记不是按时间写的，所以这段还好搞一些</li>
<li>4与外传，一个是霸道，一个是王道，外传讲老百姓的感受</li>
<li>水镜与姬良是那种结婚后的感觉，现在的爱情太过了，山盟海誓什么的，其实婚后才是爱情开始的时候，之前的去掉了</li>
<li>砍头三人组里最后说我们要永远在一起，吐槽天之痕桥段</li>
</ol>
</li>
<li>轩辕剑5一剑凌云山海情-山海界、轩辕剑5外传汉之云-三国、轩辕剑5外传云之遥-三国</li>
<li>轩辕剑6凤凌长空千载云-商周时期、轩辕剑6外传穹之扉-商朝中期</li>
<li>轩辕剑7-汉朝：轩辕剑柒（大写，为了区分网游小写七），虚幻4引擎，期待</li>
<li>轩辕伏魔录</li>
</ol>
<p>轩辕剑壹、轩辕剑貮均时代不明<br>每一部时间顺序：6+商周、2+4+在战国秦朝、7+汉朝、5++三国、3+唐朝</p>
<p>网游作品</p>
<ol>
<li>轩辕剑网游1、2：看过视频，好像一起刷蚩尤还有点意思，应该没啥剧情</li>
<li>轩辕剑7：网游，占用了7的编号 </li>
<li>轩辕剑手游：好像是基于天之痕背景的，不过没啥剧情，就是一个轩辕剑的皮</li>
<li>轩辕剑群魔录：各种日常任务跑来跑去，剧情就是因为某种原因历史混乱了，见到了各代人物</li>
<li>18年-轩辕剑龙舞云山：网易出品，水墨画风，回合制，剧情RPC，良心，不过玩完剧情就卸载了</li>
</ol>
<p>电视剧</p>
<ol>
<li>轩辕剑3小雪，拍的不好看</li>
<li>轩辕剑汉之云：只是看颜值，不过胡晓彤火了</li>
</ol>
<p>电影</p>
<ol>
<li>18年轩辕剑大电影开拍</li>
</ol>
<p>动画</p>
<ol>
<li>苍之耀动画 <a href="http://xuanyuansword.net/index.html" target="_blank" rel="noopener">http://xuanyuansword.net/index.html</a> </li>
</ol>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p>轩辕剑最大的特色是把故事埋藏在历史中，符合历史故事不冲突又补全了一些历史，非常讲究<br>世界观方面，轩辕剑设定从始至终一套，而且世界观宏伟，有趣要素很多，想象力丰富<br>而且轩辕剑里的世界观宏大，讲的故事更偏向于针对不同立场的选择造成的历史问题，没有善恶，讲霸道与王道的取舍。不像仙剑系列偏向于一个爱情故事多一些。<br>每一个单机轩辕界中都隐藏了DOMO工作室的地点，DOMO工作室印象挺深的作者：蔡明宏、曾志豪、吴欣叡、鲍弘修等人物</p>
<h4 id="黑科技"><a href="#黑科技" class="headerlink" title="黑科技"></a>黑科技</h4><p>轩辕剑里有十大神器：盘古斧（空间）、东皇钟（造界）、昆仑镜（时间）、轩辕剑（力量）、昊天塔（杀神）、炼妖壶（炼化）、神农鼎（炼药）、伏羲琴（心智）、女娲石（复活）、崆峒印（永生）</p>
<ol>
<li>前4样其实是挺逆天的，可以改变时间空间力量，中间3个算是不同种族的特殊神器，最后3个偏灵魂方面，与漫威宇宙中的5个宝石挺像的</li>
<li>神器还能组合成各种阵法：失却之阵（不同的神器放到中间效果还不一样）、九五之阵等</li>
<li>其实还有一些神器：造物仙鼎、太一轮之类的又属于神器中的神器了，一般见不着</li>
</ol>
<p>其他黑科技</p>
<ol>
<li>天书：壶中仙给辅子彻展示用的小世界</li>
<li>机关术：墨家发明的木头机械装置</li>
<li>黑火：从古蜀国柒发明的黑火与紫水晶</li>
</ol>
<h4 id="世界"><a href="#世界" class="headerlink" title="世界"></a>世界</h4><p>轩辕剑有多个世界，这里只是列举几个常出现的</p>
<ol>
<li>轩辕界（人界）</li>
<li>云中界（融合了桃源界-天书世界-桃源仙境-仙人岛）：壶中仙用东皇钟创建的，想与神州大地融合来着，不过被壶中仙实验黑火时玩坏了大半，后与天书世界融合</li>
<li>天上界：天界，包含伏羲殿，华胥国守护天门，很多仙与华胥国有关系，如伏羲与女娲是华胥子民</li>
<li>昊天界（太一神殿）：昊天帝的地盘，昊天帝又叫东皇太一，太一神殿在这里面维护世间万物生克关系控制世界的规则</li>
<li>山海界：黄帝为了用东皇钟创造的，妖怪出自山海经，有青龙白虎朱雀玄武，不过这些神兽当时都是炎帝的部下，跟天女一样被黄帝丢到山海界中了，兼职是神话异族回收厂呀。只能通过盘古斧进来</li>
<li>壶中界：炼妖壶中的世界，妖怪比较多，也有很多功能区域</li>
</ol>
<p>天山（昆仑仙境）、巫山、云中界都是仙界<br>仙是没有神厉害的，仙是世间万物修炼的最高境界，神是天生神力</p>
<p>网友总结<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">主体【轩辕界】，黄帝所创【山海界】，山海界正中印天女之地【中央界】，耶和华所在【西方天界】，撒旦所在【西方魔界】，万物轮回的【幽冥地界】，天帝居所【天界】，炼妖壶内【壶中世界】又称【壶中界】，壶中仙所创【云中界】，竹简内的【天书世界】，姬良手中天书发展而来的【桃源界】，云梦泽底【湘君界】，之罘山下【苍龙界】，太一神殿所在【昊天界】，西王母【昆仑界】，赤贯星与白贯星所在的【天上界】，紫雾源头【梵天异界】，【镜界】日向一族的神镜世界。</span><br></pre></td></tr></table></figure></p>
<h4 id="轩辕剑-1"><a href="#轩辕剑-1" class="headerlink" title="轩辕剑"></a>轩辕剑</h4><p>轩辕剑里有很多跨越千年的故事，包含穿越的剧情，形成闭环的小改变还会在原世界发送，生克太一轮重大改变事件会造成平行世界</p>
<ol>
<li>轩辕剑6商周时期姜太公改变过太一轮周克商</li>
<li>轩辕剑4外传苍之涛，太一轮秦晋相克跨越整整一千年。七曜使者的穿越故事在苍之耀动画里会涉及，导致秦朝异常发达的另一个平行世界的故事</li>
<li>轩辕剑6种凤天凌在商朝末期，最终结局时穿越到唐朝见女主，主角在唐朝老死，女主再回到男主活着的时候，然后直到女主死在这个世界，男主再穿越到唐朝形成循环</li>
</ol>
<p>轩辕剑有一些化身，集中在三国时期转世成人，诞生轩辕剑仙</p>
<ol>
<li>轩辕剑5的3部曲里介绍了轩辕剑诞生于黄帝与天女青儿之手，后转世2子朝云与暮云，后分别加入三国时期蜀与魏，最终双子合一回到山海界以暮云身份拯救母亲，在5种自杀，后朝云回到轩辕界与耶亚希在一起</li>
<li>云之遥中暮云小时候被剥离大部分灵魂到狼王身上，变为金狼，后化为人形，一直各种穿越学习王道精神，其中在轩辕剑6的故事中化为白王引领主角，后回到唐朝已经老到在轩3中遇到的轩辕剑仙老头形象</li>
</ol>
<h4 id="重要人物"><a href="#重要人物" class="headerlink" title="重要人物"></a>重要人物</h4><p>古月仙人：古月圣<br>壶中仙：炼妖壶之主<br>柒：古蜀国聪明少年<br>撒旦：路西法，西服世界魔神老大</p>
<p>妖怪有很多神话传说的，如饕餮，蚩尤<br>氐人是炎帝的后代</p>
<h4 id="有个分析帖子"><a href="#有个分析帖子" class="headerlink" title="有个分析帖子"></a>有个分析帖子</h4><ol>
<li>世界分析：<a href="http://www.lkong.net/thread-1896558-1-1.html" target="_blank" rel="noopener">http://www.lkong.net/thread-1896558-1-1.html</a></li>
<li>民间编年史：<a href="https://tieba.baidu.com/p/4331248113?red_tag=2218108712" target="_blank" rel="noopener">https://tieba.baidu.com/p/4331248113?red_tag=2218108712</a></li>
</ol>
<h3 id="仙剑"><a href="#仙剑" class="headerlink" title="仙剑"></a>仙剑</h3><p>仙剑的世界观没有打开，只是一个个独立的爱情故事<br>目前比较喜欢的是仙剑1与仙剑3、仙剑4，特别喜欢仙剑4</p>
<h4 id="作品-1"><a href="#作品-1" class="headerlink" title="作品"></a>作品</h4><ol>
<li>仙剑1 剧情好，不过电视剧垃圾</li>
<li>仙剑2，剧情垃圾</li>
<li>仙剑3、仙剑3外传，剧情好，电视剧胡歌、杨幂火了</li>
<li>仙剑4，剧情好，拍摄中</li>
<li>仙剑5，电视剧仙剑云之凡没火</li>
<li>仙剑6，讲神农，发现最终也有鱼人在鲲里，与轩辕剑氐人族一样设定，七零石的动画是一个特色</li>
<li>仙剑7，19年下半年，虚幻四引擎</li>
</ol>
<h3 id="古剑奇谭"><a href="#古剑奇谭" class="headerlink" title="古剑奇谭"></a>古剑奇谭</h3><p>古剑是从仙剑里因意见不和分裂出的团队，制作的作品也挺良心的，买了第一部玩过</p>
<h4 id="作品-2"><a href="#作品-2" class="headerlink" title="作品"></a>作品</h4><ol>
<li>古剑1，电视剧火了，李易峰，杨幂，霍建华</li>
<li>古剑2，电视剧有了，没火</li>
<li>古剑3，8月20日试玩版游戏刚出来</li>
</ol>
<h3 id="诛仙"><a href="#诛仙" class="headerlink" title="诛仙"></a>诛仙</h3><p>很早在网吧里听说过过的特别火的网游，不过没有玩过，直到后面出了电视剧才了解的剧情</p>
<h4 id="作品-3"><a href="#作品-3" class="headerlink" title="作品"></a>作品</h4><ol>
<li>电视剧青云志，诛仙，那tfboys火了，李易峰，杨紫火了</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;总结下各种剑的传说吧，他们的游戏系列，电视剧情况，网游情况，评分与推荐，剧情与特色&lt;br&gt;中国游戏改编的古装剧是很有特色的，基本都与剑有关，拍一部火一部&lt;br&gt;传统单机三剑是：轩辕剑、仙剑、剑侠情缘，不过剑侠情缘感觉后续剧情上不怎么火，也没怎么玩过&lt;/p&gt;
&lt;p&gt;这里介绍的
    
    </summary>
    
      <category term="娱乐" scheme="https://dawell.github.io/categories/%E5%A8%B1%E4%B9%90/"/>
    
    
      <category term="游戏" scheme="https://dawell.github.io/tags/%E6%B8%B8%E6%88%8F/"/>
    
      <category term="轩辕剑" scheme="https://dawell.github.io/tags/%E8%BD%A9%E8%BE%95%E5%89%91/"/>
    
      <category term="仙剑" scheme="https://dawell.github.io/tags/%E4%BB%99%E5%89%91/"/>
    
  </entry>
  
  <entry>
    <title>轩辕剑龙舞云山体验感悟</title>
    <link href="https://dawell.github.io/2018/08/17/%E8%BD%A9%E8%BE%95%E5%89%91%E9%BE%99%E8%88%9E%E4%BA%91%E5%B1%B1%E4%BD%93%E9%AA%8C%E6%84%9F%E6%82%9F/"/>
    <id>https://dawell.github.io/2018/08/17/轩辕剑龙舞云山体验感悟/</id>
    <published>2018-08-17T07:13:32.000Z</published>
    <updated>2018-08-22T07:07:16.878Z</updated>
    
    <content type="html"><![CDATA[<p>好久没有玩游戏了，手游RPC类型的也没有玩过，这次尝试下<br>小时候单机最爱玩的RPC游戏是轩辕剑，最近网易推出了这个IP的手游轩辕剑龙舞云山，听说继承了轩辕剑水墨画风非常唯美<br>正好删档公测申请体验了下，8月23日删档</p>
<p>游戏体验目的</p>
<ol>
<li>一个是想看下轩辕剑有什么新剧情</li>
<li>一个是看看现在的RPC手游都做成什么样子了</li>
<li>如果自己开发一个这样的游戏是否复杂</li>
<li>我玩的到底是什么，是什么让我放弃了这款游戏，游戏的本质是什么？</li>
</ol>
<h2 id="体验过程"><a href="#体验过程" class="headerlink" title="体验过程"></a>体验过程</h2><p>进去后先是取个名字，皇帝姓氏“姬”代表正统与历史，然后偏爱轩辕剑4里的墨家机关术，取一“墨”字，组合为“姬墨”（寂寞），好名~<br>有6个角色可以相当于传统游戏中的角色吧<br>剑士T（龙武军-男）、剑士输出（沧剑盟-男）、法师（琉璃会-女）、奶妈（灵素庄-女）、萨满（天道师-男童）、机械师（隐墨宗-女童）<br><img src="https://images.gitee.com/uploads/images/2018/0821/141357_aa120c5a_697510.png" alt="输入图片说明" title="屏幕截图.png"><br>隐墨宗继承了墨家机关术，是我比较钟爱的门派，不过只能选女号<br><img src="https://images.gitee.com/uploads/images/2018/0821/141529_97086a5a_697510.png" alt="输入图片说明" title="屏幕截图.png"><br>本以为还有捏脸环节，实际只是选个3种发型与3种容貌，衣服也没法换，不过角色还算ok，不Care<br><img src="https://images.gitee.com/uploads/images/2018/0821/141607_8af0197a_697510.png" alt="输入图片说明" title="屏幕截图.png"><br>游戏的功能随着等级提升逐步开放，基本上60级功能就开的差不多了<br>等级提升前期非常快，第一天任务做完就差不多40级了，第二天50级，第三天57级，第四天60级，直到后面一天只能生1级左右，然后我最终玩到了74级就停止了<br>剧情都玩完了，活动基本玩了一遍，副职业都开启了，宠物也都差不多了</p>
<h2 id="剧情"><a href="#剧情" class="headerlink" title="剧情"></a>剧情</h2><p>背景设定在天之痕之后的100年唐盛时期<br>整个剧情有主线，围绕着撒旦魔王利用妮可复活假赛特，指挥核心骨干康那里士去收集黑火企图消灭神州大地的部分<br>同时有唐歌主线，体现唐朝表面繁荣，而内部各种政治斗争，贵妃+国舅党、太子+忠臣党、安禄山+西方妖魔党3者的冲突<br>轩辕主线与唐歌主线是有剧情交差的，只是突出的重点不太一样<br>也有各种支线任务，与各种NPC有关系，也有各种护驾的支线剧情任务，介绍各种护驾的历史吧</p>
<p>整体上还挺像单机游戏的风格，而且还接入了类似轩辕剑的DOMO工作室的设计人物与场地，用一口井进去，肥鱼宫，应该是游戏制作工作室的名字吧<br><img src="https://images.gitee.com/uploads/images/2018/0821/143346_9931118a_697510.png" alt="输入图片说明" title="屏幕截图.png"><br><img src="https://images.gitee.com/uploads/images/2018/0821/143830_1447ba3f_697510.png" alt="输入图片说明" title="屏幕截图.png"></p>
<h3 id="主线剧情"><a href="#主线剧情" class="headerlink" title="主线剧情"></a>主线剧情</h3><p>进去后剧情遇到古月仙人，喝三杯酒，然后穿越到100年前封印天之痕的时候，与小雪、玉儿、靖仇相遇，然后回到现实中与玉儿的转世结缘<br><img src="https://images.gitee.com/uploads/images/2018/0821/141659_1cc0f623_697510.png" alt="输入图片说明" title="屏幕截图.png"><br><img src="https://images.gitee.com/uploads/images/2018/0821/142529_e9c3120c_697510.png" alt="输入图片说明" title="屏幕截图.png"><br>主角还有个特殊身份是神器守护者，只是剧情需要，暂时没什么特殊技能之类的<br><img src="https://images.gitee.com/uploads/images/2018/0821/142714_f08542f0_697510.png" alt="输入图片说明" title="屏幕截图.png"><br>转世的玉儿体内有黑火，康那里士来取黑火，然后被主角救走，主角买了一个天道师山寨的炼妖壶可以收纳万物，将玉儿放入其内，黑火结晶紫水晶也带走一些<br>主角先是带到江湖百晓生唐佑那里打探情报，然后被指引到琉璃会长那里，琉璃会发现紫水晶与琉璃的宝物差不多质地，而且牵起一段回忆，发现副会长也是被琉璃中的妖邪附身与康那里士变为一伙<br>后指引到隐墨宗看病，五长老也牵出一段当时因为利用黑火力量搞机关术失败导致妻儿死亡的回忆，结果康那里士找到了这里，为了迎战康那里士几位长老凑齐了，大长老出现，宇文拓也出现了，众人赶走了康师傅（大长老是个利用宗门技法的童颜美少女，大长老一直迷着宇文拓）<br>妮可复活假赛特不惜一切代价，所以与主角发生几次正面冲突，第一次还与天神李靖交战，后来妮可发现了被魔王利用，而黑火导致各种失魂的人也越来越多<br><img src="https://images.gitee.com/uploads/images/2018/0821/144902_3bd05559_697510.png" alt="输入图片说明" title="屏幕截图.png"><br>安禄山想用魔族给他的黑火反兵皇帝，不过后面还没展开剧情<br>在墨家大长老出现的还是还介绍了一段与宇文拓认识的黑历史，当时宇文拓想要封印天之痕需要上天上界的方法，询问了隐墨宗，宇文拓解释一番，是个火车难题，隐墨宗权衡后提供了万灵血珠的制作方法，宇文拓独立背负罪名这点让大长老就迷上他了<br><img src="https://images.gitee.com/uploads/images/2018/0821/144415_eff8ad1f_697510.png" alt="输入图片说明" title="屏幕截图.png"><br><img src="https://images.gitee.com/uploads/images/2018/0821/144533_0ffb3d03_697510.png" alt="输入图片说明" title="屏幕截图.png"><br>后面剧情就没了…感觉主创们还没做完</p>
<h2 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h2><h3 id="功能拆分"><a href="#功能拆分" class="headerlink" title="功能拆分"></a>功能拆分</h3><ol>
<li><em>个人+提升、地图、境界（剧情+任务）、设置+拍照、战斗</em></li>
<li><em>物品：装备、行囊、宠物、商城+摆摊</em></li>
<li>（网游加强）副职业：闲趣、行当、书斋</li>
<li>（网游加强）统计：传记（成就）、排行</li>
<li><em>【网游特有】关系与交互：好友、聊天、队伍、帮派</em></li>
<li>【网游特有】活动与扩展：活动、福利</li>
<li>游戏外功能：选择大区与用户，创建用户，公告，用户协议，客服，修复，用户中心账号，二维码扫描</li>
</ol>
<p>如果是做单机，前2个有了，基本上可玩性就有了，接下来就是打磨剧情与任务了<br>如果是做网游，最核心的是第5条，其次是第6条<br>目前看一共有170级吧，不过剧情大约70级就没了，所以应该是个半成品</p>
<h3 id="从最小产品去开发"><a href="#从最小产品去开发" class="headerlink" title="从最小产品去开发"></a>从最小产品去开发</h3><p>首先要有主角（等级、属性）、剧情任务、战斗、地图、设置这5个模块</p>
<ol>
<li>主角具备等级，通过任务引导玩家去战斗，然后提升等级完成更多的任务看到剧情，然后任务+打怪给经验继续提升，任务完成取决于等级，而等级取决于战斗，任务又引导战斗形成闭环</li>
<li>整个RPC的目前是为了完成更多的任务，看到更多的剧情，体验战斗的乐趣，等级本身只是条件。任务与战斗是RPC的核心，升级是手段</li>
<li>人数属性：生命、物理攻击-防御，回合制</li>
</ol>
<p><img src="https://images.gitee.com/uploads/images/2018/0821/141806_5d37558e_697510.png" alt="输入图片说明" title="屏幕截图.png"></p>
<p>基于水墨风格的场景设计是好的，画面流畅优雅，看了下其实很多场景是指几个图片增加一些层次做出的并非是3D的，只有人物是3D的，减少了页面元素渲染的成本<br><img src="https://images.gitee.com/uploads/images/2018/0821/142205_23f6c489_697510.png" alt="输入图片说明" title="比如这个井看上去是3D的但是就是一个图片而已"><br><img src="https://images.gitee.com/uploads/images/2018/0821/142317_e0410289_697510.png" alt="输入图片说明" title="这里边缘没控制好，可以看到这个悬崖只是一个图片加一个边缘限制"></p>
<h3 id="围绕人物-任务-战斗3个核心属性，丰富-amp-差异化人物属性、更有趣的战斗体验、添加物品要素提升各种环节"><a href="#围绕人物-任务-战斗3个核心属性，丰富-amp-差异化人物属性、更有趣的战斗体验、添加物品要素提升各种环节" class="headerlink" title="围绕人物+任务+战斗3个核心属性，丰富&amp;差异化人物属性、更有趣的战斗体验、添加物品要素提升各种环节"></a>围绕人物+任务+战斗3个核心属性，丰富&amp;差异化人物属性、更有趣的战斗体验、添加物品要素提升各种环节</h3><p>先将个人属性丰富起来，然后差异化个人属性，然后丰富战斗，然后添加通用设计-物品加强属性、任务、战斗整个环节</p>
<ol>
<li>人数属性增加<ol>
<li>增加法力、控制2个类型输出、增加攻击前、攻击后的各种属性效果，增加速度</li>
<li>生命、法力、控制-控制抵抗（辅助效果）、速度、物理攻击-防御（输出-中）、法术攻击-防御（输出-中）、命中-躲闪（打中-前）、暴击-强化-吸收（打中效果叠加-后）、阴阳属性（加强+追击-后）<br><img src="https://images.gitee.com/uploads/images/2018/0821/142757_06716d38_697510.png" alt="输入图片说明" title="战斗生克关系"></li>
</ol>
</li>
<li>人物属性加持优化<ol>
<li>添加职业</li>
<li>装备，装备打造+强化属性+随机属性的炼化</li>
<li>战斗模式切换（群攻、单攻）</li>
<li>添加属性加点，奇异果实提升，补天宝石，天数灵修加属性</li>
</ol>
</li>
<li>法力+控制的战斗优化<ol>
<li>增加技能，添加技能书，技能升级加点</li>
</ol>
</li>
<li>物品分为药品+功能道具、任务、装备，这些东西有些是可以进行交易的（过一会再讲交易），有些则不可只能丢弃<ol>
<li>装备，每个部位的，头饰、衣服、腰带、武器、鞋子、项链、戒指、玉佩、通宝1，通宝2</li>
<li>特殊武器-宠物系统可以丰富（宠物的等级、属性、技能，不需要装备），不过有天资（有上限，耐力、力量、灵性、智慧、敏捷、成长率），增长不同的属性，玩家可以洗练天赋+突破提升阶级+提升属性（氪金材料）</li>
<li>除了物品，还有金币，铜币等金钱的奖励</li>
<li>物品的话可以通过官方商城买卖，不过像模式这种都是用户自己在拍卖行里操作，没有上帝颁发东西，不需要氪金，更加公平</li>
<li>物品位不够了需要放到仓库，仓库可以分几个，多的需要额外收费</li>
</ol>
</li>
</ol>
<p>可以看出人物差异通过人物属性加持自己配置的，需要方法论固定提升，而宠物则避免复杂采用一个随机的天资控制，有一些随机性，生成需要炼妖系统合成<br>技能是基于属性发挥的效果，宠物的技能需要收集配置通用，而角色职业是固定的，其实也可以差异化加点激活，类似魔兽不过复杂一些<br>技能还能让战斗更加华丽，不过大家在升级时一直用华丽技能也腻了，所以现在回合制都开发了自动战斗的模式，而开放式战斗自己控制更有意思些</p>
<p>最终除了核心3要素，又增加了物品这一要素丰富了玩法成为4要素</p>
<ol>
<li>人物通过物品加持更改，消费物品</li>
<li>任务不止奖励经验，还奖励金币+物品，生产消费物品，不过更偏向于生产</li>
<li>战斗也可以消耗金币与物品，除了经验，也可以奖励金币与物品，生产消费物品，不过更偏向于生产</li>
</ol>
<p>排列组合</p>
<ol>
<li>前2个形成供需关系（任务完成奖励提升能力）</li>
<li>后2个也可以形成供需（战斗生产完成任务物品消耗，战斗消耗品只能任务领取发放）</li>
<li>而头尾2个也可以形成供需（战斗胜利品提升能力）</li>
<li>中自己形成供需（上个任务的奖励是下个任务的消费）</li>
<li>尾自己形成供需（上个战斗的奖励是下个战斗的消耗品）</li>
</ol>
<p>通过形成的这6种组合组成了更加丰富的任务、提升方式、战斗方式</p>
<h4 id="战斗系统"><a href="#战斗系统" class="headerlink" title="战斗系统"></a>战斗系统</h4><p>回合制在个人战斗是携带5个宠物，而团战时满员只携带第一只宠物<br>回合制只需要操作2个单位，剩余单位是自动的<br>一般发怪用自动战斗<br>回合制的灵活性差一些，所以针对boss的打法相对固定，挑战性小一些</p>
<p>隐墨宗的战斗系统是特殊一些的，分为2个形态<br>形态1就是普通输出，单控能力强，可以增加锁定控制的特殊效果<br>形态2是大规模输出，比其他职业输出更强，但是需要牺牲一个符鬼，而且不能连续2回合使用，而中间环节普通输出技能也无法使用只能普通攻击与使用物品或者召唤控制多一些<br>所以这里面使用时机需要把握，召唤兽的顺序也很重要，还是挺好玩的</p>
<p>助战就是选择一组宠物，可以配置3组选1</p>
<p><img src="https://images.gitee.com/uploads/images/2018/0821/150257_0e78ac7a_697510.png" alt="输入图片说明" title="屏幕截图.png"></p>
<h4 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h4><p>因为任务与战斗都提供了自动机制，所以有些活动都是全自动的每日完成，只要手机挂在那里就行了，多少让我觉得有些浪费时间，这些每天不得不做又要占用手机的时间，还不如让我好好玩玩<br>其实最讨厌的就是自动任务了，自己也玩不了，但是每天都要强迫自己去浪费这个时间…</p>
<p>任务亮点在于NPC是有配音的，并且有些还用了方言，所以一听就是良心作品，不过只有主线有配音，这个做的挺好的</p>
<h4 id="炼妖-amp-合成系统"><a href="#炼妖-amp-合成系统" class="headerlink" title="炼妖&amp;合成系统"></a>炼妖&amp;合成系统</h4><p>分为2种：炼妖与机关组装2种，玩法不一样</p>
<ol>
<li>炼妖：通过炼妖炉合成，需要遵循五行相生，相克失败更高</li>
<li>机关：需要收集组件合成</li>
</ol>
<p><img src="https://images.gitee.com/uploads/images/2018/0821/143124_39921bfc_697510.png" alt="输入图片说明" title="屏幕截图.png"></p>
<p>他们引入这2个系统真的是结合了单机的玩法，还是挺良心的<br>2种模式要考虑平衡性，炼妖与零件合成的概率应该是差不多的</p>
<p>炼妖要去壶中界去炼，这里游戏设定壶中界因为某种原因与炼妖壶神器脱离了成了一个地方<br><img src="https://images.gitee.com/uploads/images/2018/0821/142928_6dddf0d7_697510.png" alt="输入图片说明" title="屏幕截图.png"></p>
<h4 id="天书系统"><a href="#天书系统" class="headerlink" title="天书系统"></a>天书系统</h4><p>天书的概念也是轩辕剑的一个特点，这次也加进去了<br>不过天书搞得与炼妖壶很像了，有各种工厂其实都是固定的设施，功能其实也比较鸡肋，炼化符，制成一些水晶用于升级技能用<br>基本上天书其实是对物品要素的加强，就是炼化物品<br>不过单机里天书可以自己选择地方建造建筑物，类似一个建造型的内部游戏了，针对我这种钟爱建设发展的用户真是喜欢的不得了，不过这网游没那么灵活的建造功能，只能升级，当时的天书里还有DOMO入口<br>单机天书里还能炼妖合成，妖怪属性的提升等，不过这里只是炼化物品（一个是普通的药品、一个是战斗特殊buff），而炼妖放到了壶中界中炼化，而妖怪属性提升是单独的洗练操作<br>其实天书炼妖壶是个很好的设定，可以在这里炼化物品，炼化宠物，同时培养一些副职业，还可以搞建筑发展</p>
<p>这里游戏中天书世界也是独立存在，只需要有天书入口的密码即可进入这个世界，并且由姬良（张良）管理，也就是轩辕剑4的男主<br><img src="https://images.gitee.com/uploads/images/2018/0821/143605_b8723d9d_697510.png" alt="输入图片说明" title="屏幕截图.png"></p>
<h3 id="副职业"><a href="#副职业" class="headerlink" title="副职业"></a>副职业</h3><p>其实一般的游戏中都有点小游戏会有趣一些，或者说有时候还会给出一些彩蛋与惊喜</p>
<p>休闲包括：画画、知识问答、诗词、弹曲、打牌、演戏几个方向，对应了行当（副职业）的几种：画师、博士、诗人、乐师、谋士、怜人6大副职业</p>
<ol>
<li>画师就是收集各种场景中的植物山水然后拼图打分</li>
<li>博士一个是找NPC答题考核，一个是每次会弹出一些知识问答答对了提升学识</li>
<li>诗人就是完成活动任务给一些诗词的单句最终凑齐一首诗，然可以与匹配的一个人比对诗词，就看自己收集了多少用于应答各种场景</li>
<li>乐师比较好玩，瞬间变成音乐节奏游戏，跟进游戏中的乐谱找NPC收集，然后选择难度弹奏，困难的的是真的很难~<br><img src="https://images.gitee.com/uploads/images/2018/0821/150114_1f753c5a_697510.png" alt="输入图片说明" title="屏幕截图.png"></li>
<li>谋士也是找NPC收集卡片，类似简单的扑克，然后与NPC打牌</li>
<li>怜人就是排练舞台剧，类似一个简单的动画制作软件，可以选择背景，出场人物，音乐，转场效果，指定台词，排练完了发布，会受到点赞与评论<br><img src="https://images.gitee.com/uploads/images/2018/0821/144001_28043b15_697510.png" alt="输入图片说明" title="屏幕截图.png"></li>
</ol>
<p><img src="https://images.gitee.com/uploads/images/2018/0821/145426_b7b87ab0_697510.png" alt="输入图片说明" title="屏幕截图.png"></p>
<p>书斋分为4个：一个是副职业的NPC、一个是豪杰就是重点NPC人物、一个是神魔记录，还有一个收集的诗句<br>每一个都会记录里面的任务事件与人物背景</p>
<p>副职业</p>
<ol>
<li>里面维护与每个NPC的好感度，好感度好的话NPC就会把自己的副职业的道具给出来</li>
<li>NPC的好感度有个氪金的花买了后可以直接提升到满级</li>
<li>NPC的情报可以去小二那边打听，每次只能打听到3条情报，而且每天只有一次问小二的机会，这个设计还挺好的</li>
</ol>
<p>神魔记录类似单机里的神魔记录簿，图鉴，也算是继承了特色了</p>
<h3 id="统计"><a href="#统计" class="headerlink" title="统计"></a>统计</h3><p>成就、排行其实就是一般的统计数据的结果吧，这个没啥好说的</p>
<p>特别点</p>
<ol>
<li>每个地点有些眼睛点击后可以看到地点的一些故事，收集多了会达成成就</li>
</ol>
<h3 id="关系与交互"><a href="#关系与交互" class="headerlink" title="关系与交互"></a>关系与交互</h3><p>好友、聊天</p>
<ol>
<li>频道聊天，包含系统、世界、当前、帮派、队伍</li>
<li>好友列表与最近联系，可以添加好友，会跟你个人兴趣标签去匹配推荐</li>
<li>圈子主要是朋友做过哪些事件</li>
<li>邮箱，接收奖励与任务通知</li>
<li>聊天窗口可以配置显示哪些频道信息，相当于频道聊天的快捷显示</li>
<li>提供了连接麦克风的语音聊天方式，比较有趣的是在战斗中语音会自动翻译成弹幕飘在屏幕中</li>
</ol>
<p>队伍、帮派</p>
<ol>
<li>可以创建队伍，也可以便捷组队，选定哪些任务加入or创建，NPC里接任务时也会提示便捷组队，等待一段后会提示是否自己当队长</li>
<li>帮派：可以管理成员，帮派是每小时是耗费资金的，所以需要做帮派任务才行，否则会解散，活动任务主要是丝绸之路与对战了，奇异果实可以在这里买</li>
</ol>
<p>副职业是每个角色都可以学习的，没有差异性，魔兽中只有法师能开传送门，做水与面包，每个职业的副职业都有特殊点促进好友交流<br>魔兽中有意思的还有语言差异，听不懂对方说的</p>
<h4 id="空间"><a href="#空间" class="headerlink" title="空间"></a>空间</h4><p>空间感觉是在关系里是个亮点，可以配置自己的个性化标签，然后用于推荐好友用<br>一个是背景除了竹林与角色图还可以配置几张个人上传的图片<br>个人标签可以从性格、兴趣、行业、特征4个维度配置8个标签<br>空间还可以互赞，所以里面还有一个小的消息系统<br>可以配置定位、里面的动态就是个人的圈子的内容<br>还有一个盆栽是好友赠送用的</p>
<p><img src="https://images.gitee.com/uploads/images/2018/0821/145548_83ccdaf2_697510.png" alt="输入图片说明" title="屏幕截图.png"></p>
<p>感觉这个空间的设计可以加强好友互动，社交用的，可惜好友都是陌生人，也没发挥什么作用…</p>
<h3 id="活动"><a href="#活动" class="headerlink" title="活动"></a>活动</h3><p>每天都有各种活动，有丰富奖励，活动内容每天不一样，所以活动里还提供了日历的预告功能<br>活动每天有经验限制，并且完成个数后有额外奖励，最多8个任务完成有额外奖励。活动提供3种玩法<br>悠闲、江湖、一剑凌云，休闲小游戏偏多，一剑凌云是剧情与挑战PK等任务，而江湖偏向于支线任务与混合<br>活动基本上是做副职业的挑战，刷各种副本，完成历史剧情任务，完成帮派任务，完成日常任务</p>
<p>还有比较大的活动</p>
<ol>
<li>帮派任务：丝绸之路、挑战个人战绩</li>
<li>日常任务：师门任务、抓盗贼、机器人选策略挑战、抓符鬼</li>
<li>历史剧情任务：回到天之痕的各个阶段协助主角做任务，不过里面的任务都比较有挑战，需要技巧才能获胜，比如有的时候需要防御，阴阳相克，特殊技能</li>
<li>各种副本：限时开放的刷龙九子、遗迹、封印妖怪</li>
<li>副职业挑战：各种闲趣完成次数</li>
</ol>
<p><img src="https://images.gitee.com/uploads/images/2018/0821/145002_37a72556_697510.png" alt="输入图片说明" title="屏幕截图.png"></p>
<p>福利也有很多</p>
<ol>
<li>每日登陆奖励</li>
<li>绑定手机号</li>
<li>神秘暗号（外部活动奖励码）</li>
<li>充值奖励？</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总体上还是很有诚意的作品，不过坚持玩不会超过7天吧，差不多战斗与社交没有亮点，冲着画面与剧情发力更像是在玩单机RPC游戏</p>
<ol>
<li>画面：水墨风好评，看着自动转动3D视角也很有电影的感觉，这个也是继承了单机的设计</li>
<li>失败点：RPC玩单机玩的是剧情与战斗，而网游玩的是社交与战斗，我觉得这游戏做的最失败的一点是社交，好友都是虚的，都是不认识的人，这点会丧失RPC网游里最核心持之以恒的玩法</li>
<li>战斗：有挑战的副本战斗我其实玩隐墨宗还是挺爽的，但是因为是回合制，大多都是自动战斗，所以不是每次都能体会到战斗的乐趣的</li>
<li>任务：不过除了社交的玩法，其他传统单机优点剧情任务做的不错，确实也有些轩辕剑剧情的干货。不过我要是单纯为了剧情我可以去看网上的剧情剪辑流，不玩就能看，没必要去氪金与感受中间的不公平</li>
<li>副业：而还有不错就是可以闲情小游戏的各种玩法也比较有趣，不过这种如果专门去玩就没必要在这么大RPC里去玩了，更像是成就系统，社交有得玩这个才有意义，所以这里就有些鸡肋了</li>
</ol>
<p>而轩辕剑在我周围认识的人里对其着迷的还只是少数人，而宣传为魔兽这样的游戏又不具备公平而完善的玩法，而且动画各种成本太高对于手游，其实发展社交确实挺难的，除非有腾讯的那种资源天然就有社交优势<br>所有手机RPC如果不重视社交与战斗注定是失败的快餐游戏，即使消费单机的IP，大家也都是冲着剧情来玩的，没有剧情玩完就走了<br>其实这种类似的游戏也挺多的，打着一个好的IP，然后做的网游也就是体验下，在氪金的情况下后期就放弃完了，比如什么火影呀日漫游戏的IP，而轩辕剑这部还好点，有不错的剧情任务，比其他IP游戏要良心，不过战斗与社交都是硬伤，注定都不能持久<br>现在手机游戏排行榜一般都是一些低频爽的游戏，如吃鸡、荣耀、部落、穿火、飞车、音乐对战类的游戏，这种游戏适合在手机上与旁边的好友同事偶尔玩一下，自己也可以爽一下得到放松，比RPC要更加持久<br>不过因为是公测，剧情与升级吸引我的地方所需要的氪金都是没有的，而真正玩家在玩的时候可能会氪金玩剧情，所以走剧情模式也不一定赔钱，只是玩完剧情后很空虚，所以后面会变为一个一次性游戏了吧</p>
<h3 id="游戏模式感悟"><a href="#游戏模式感悟" class="headerlink" title="游戏模式感悟"></a>游戏模式感悟</h3><p>从开发角度看下开发的复杂性，其实游戏做个最简单的模式也不难，但是一旦把元素丰富起来，玩法就非常多了，不过这正好可以充分去使用面向对象的思路去设计，才能做到如此灵活而扩展<br>如果是建造类其实闭环更加简单，比如开罗游戏，城市建设需要钱，则钱需要通过订单服务（战斗+任务）然后生产钱，钱又可以造更好的建设生产更多的钱，形成一个循环，不过这个的核心是升级发展重点在主角（城市），订单是手段，因为只有2个核心，可以将2个核心扩大到更复杂<br>魔兽是社交与战斗做的都很好，帮派分明有特色，而DNF是战斗做的好，专注于副本，只有在网游特点中突出的游戏才能持久<br>后面尝试自己去设计一款游戏试试（开新坑=。=），估计会很有意思~</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;好久没有玩游戏了，手游RPC类型的也没有玩过，这次尝试下&lt;br&gt;小时候单机最爱玩的RPC游戏是轩辕剑，最近网易推出了这个IP的手游轩辕剑龙舞云山，听说继承了轩辕剑水墨画风非常唯美&lt;br&gt;正好删档公测申请体验了下，8月23日删档&lt;/p&gt;
&lt;p&gt;游戏体验目的&lt;/p&gt;
&lt;ol&gt;

    
    </summary>
    
      <category term="娱乐" scheme="https://dawell.github.io/categories/%E5%A8%B1%E4%B9%90/"/>
    
    
      <category term="游戏" scheme="https://dawell.github.io/tags/%E6%B8%B8%E6%88%8F/"/>
    
      <category term="轩辕剑" scheme="https://dawell.github.io/tags/%E8%BD%A9%E8%BE%95%E5%89%91/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-番外篇-源码解析</title>
    <link href="https://dawell.github.io/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    <id>https://dawell.github.io/2018/08/13/SpringCloud-番外篇-源码解析/</id>
    <published>2018-08-13T08:07:04.000Z</published>
    <updated>2018-08-17T07:54:41.340Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud文章系列"><a href="#SpringCloud文章系列" class="headerlink" title="SpringCloud文章系列"></a>SpringCloud文章系列</h1><ol>
<li><a href="http://dawell.cc/2018/08/01/SpringCloud/" target="_blank" rel="noopener">SpringCloud</a></li>
<li><a href="http://dawell.cc/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-注册中心</a></li>
<li><a href="http://dawell.cc/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-配置中心</a></li>
<li><a href="http://dawell.cc/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" target="_blank" rel="noopener">SpringCloud-链路跟踪</a></li>
<li><a href="http://dawell.cc/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" target="_blank" rel="noopener">SpringCloud-消息总线</a></li>
<li><a href="http://dawell.cc/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/" target="_blank" rel="noopener">SpringCloud-API网关</a></li>
<li><a href="http://dawell.cc/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/" target="_blank" rel="noopener">SpringCloud-异步消息</a></li>
<li><a href="http://dawell.cc/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/" target="_blank" rel="noopener">SpringCloud-同步调用</a></li>
<li><a href="http://dawell.cc/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/" target="_blank" rel="noopener">SpringCloud-断路降级</a></li>
<li><a href="http://dawell.cc/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">SpringCloud-监控管理</a></li>
<li><a href="http://dawell.cc/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">SpringCloud-番外篇-临时任务</a></li>
<li><a href="http://dawell.cc/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/" target="_blank" rel="noopener">SpringCloud-番外篇-文档生成</a></li>
<li>【当前文章】<a href="http://dawell.cc/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">SpringCloud-番外篇-源码解析</a></li>
</ol>
<p>敬请期待…</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SpringCloud文章系列&quot;&gt;&lt;a href=&quot;#SpringCloud文章系列&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud文章系列&quot;&gt;&lt;/a&gt;SpringCloud文章系列&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
      <category term="技术" scheme="https://dawell.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringCloud" scheme="https://dawell.github.io/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-番外篇-文档生成</title>
    <link href="https://dawell.github.io/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/"/>
    <id>https://dawell.github.io/2018/08/12/SpringCloud-番外篇-文档生成/</id>
    <published>2018-08-12T07:43:56.000Z</published>
    <updated>2018-08-17T07:54:41.444Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud文章系列"><a href="#SpringCloud文章系列" class="headerlink" title="SpringCloud文章系列"></a>SpringCloud文章系列</h1><ol>
<li><a href="http://dawell.cc/2018/08/01/SpringCloud/" target="_blank" rel="noopener">SpringCloud</a></li>
<li><a href="http://dawell.cc/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-注册中心</a></li>
<li><a href="http://dawell.cc/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-配置中心</a></li>
<li><a href="http://dawell.cc/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" target="_blank" rel="noopener">SpringCloud-链路跟踪</a></li>
<li><a href="http://dawell.cc/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" target="_blank" rel="noopener">SpringCloud-消息总线</a></li>
<li><a href="http://dawell.cc/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/" target="_blank" rel="noopener">SpringCloud-API网关</a></li>
<li><a href="http://dawell.cc/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/" target="_blank" rel="noopener">SpringCloud-异步消息</a></li>
<li><a href="http://dawell.cc/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/" target="_blank" rel="noopener">SpringCloud-同步调用</a></li>
<li><a href="http://dawell.cc/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/" target="_blank" rel="noopener">SpringCloud-断路降级</a></li>
<li><a href="http://dawell.cc/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">SpringCloud-监控管理</a></li>
<li><a href="http://dawell.cc/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">SpringCloud-番外篇-临时任务</a></li>
<li>【当前文章】<a href="http://dawell.cc/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/" target="_blank" rel="noopener">SpringCloud-番外篇-文档生成</a></li>
<li><a href="http://dawell.cc/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">SpringCloud-番外篇-源码解析</a></li>
</ol>
<p>敬请期待…</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SpringCloud文章系列&quot;&gt;&lt;a href=&quot;#SpringCloud文章系列&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud文章系列&quot;&gt;&lt;/a&gt;SpringCloud文章系列&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
      <category term="技术" scheme="https://dawell.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringCloud" scheme="https://dawell.github.io/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-番外篇-临时任务</title>
    <link href="https://dawell.github.io/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/"/>
    <id>https://dawell.github.io/2018/08/11/SpringCloud-番外篇-临时任务/</id>
    <published>2018-08-11T07:41:14.000Z</published>
    <updated>2018-08-17T07:54:41.418Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud文章系列"><a href="#SpringCloud文章系列" class="headerlink" title="SpringCloud文章系列"></a>SpringCloud文章系列</h1><ol>
<li><a href="http://dawell.cc/2018/08/01/SpringCloud/" target="_blank" rel="noopener">SpringCloud</a></li>
<li><a href="http://dawell.cc/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-注册中心</a></li>
<li><a href="http://dawell.cc/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-配置中心</a></li>
<li><a href="http://dawell.cc/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" target="_blank" rel="noopener">SpringCloud-链路跟踪</a></li>
<li><a href="http://dawell.cc/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" target="_blank" rel="noopener">SpringCloud-消息总线</a></li>
<li><a href="http://dawell.cc/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/" target="_blank" rel="noopener">SpringCloud-API网关</a></li>
<li><a href="http://dawell.cc/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/" target="_blank" rel="noopener">SpringCloud-异步消息</a></li>
<li><a href="http://dawell.cc/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/" target="_blank" rel="noopener">SpringCloud-同步调用</a></li>
<li><a href="http://dawell.cc/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/" target="_blank" rel="noopener">SpringCloud-断路降级</a></li>
<li><a href="http://dawell.cc/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">SpringCloud-监控管理</a></li>
<li>【当前文章】<a href="http://dawell.cc/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">SpringCloud-番外篇-临时任务</a></li>
<li><a href="http://dawell.cc/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/" target="_blank" rel="noopener">SpringCloud-番外篇-文档生成</a></li>
<li><a href="http://dawell.cc/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">SpringCloud-番外篇-源码解析</a></li>
</ol>
<h3 id="接入说明"><a href="#接入说明" class="headerlink" title="接入说明"></a>接入说明</h3><ol>
<li>目前采用最新的1.xRelease版本：1.5.15.RELEASE</li>
<li>SpringCloud项目可以在start.spring.io下载，不过更方便的应该是通过idea新建项目，建立Spring Initializr项目</li>
<li>我一般习惯将具体实现服务用具体的服务名，而公共组件用service-xxx来命名，当然还有一些比较固定名字的公共组件</li>
</ol>
<h3 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h3><h4 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1. 新建项目"></a>1. 新建项目</h4><p>新建artifactId为service-task的服务</p>
<h4 id="2-导入依赖"><a href="#2-导入依赖" class="headerlink" title="2. 导入依赖"></a>2. 导入依赖</h4><p>依赖说明</p>
<ol>
<li>actuator用于暴露监控的接口</li>
<li>eureka-server是Eureka服务器的依赖</li>
<li>config是Config客户端，从配置中心拉取配置</li>
<li>task用于短命服务的依赖</li>
<li>jpa与mysql的依赖用于存储task相关的数据</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-task<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-编写启动类"><a href="#3-编写启动类" class="headerlink" title="3. 编写启动类"></a>3. 编写启动类</h4><p>打开ServiceTaskApplication，在class上加入@EnableTask注解</p>
<h4 id="4-修改配置"><a href="#4-修改配置" class="headerlink" title="4. 修改配置"></a>4. 修改配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server.port=8060</span><br><span class="line">spring.application.name=service-task</span><br><span class="line"></span><br><span class="line">#private</span><br><span class="line">spring.datasource.driverClassName=com.mysql.jdbc.Driver</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost:3306/springcloud</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=xxx</span><br><span class="line">spring.jpa.database=MySQL</span><br><span class="line">spring.jpa.show-sql=true  </span><br><span class="line">spring.jpa.generate-ddl=true  </span><br><span class="line">spring.jpa.hibernate.ddl-auto=update</span><br><span class="line">spring.jpa.hibernate.naming_strategy=org.hibernate.cfg.ImprovedNamingStrategy</span><br></pre></td></tr></table></figure>
<p>主要配置jpa与datasource链接到mysql数据库，如果使用内存存储则不需要任何数据库配置</p>
<h4 id="5-编写方法"><a href="#5-编写方法" class="headerlink" title="5. 编写方法"></a>5. 编写方法</h4><p>在main类中编写CommandLineRunner相关接口task会全部执行完</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableTask</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceTaskApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ServiceTaskApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommandLineRunner <span class="title">commandLineRunner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> strings -&gt; System.out.println(<span class="string">"Hello World!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CommandLineRunner <span class="title">commandLineRunner2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> strings -&gt; System.out.println(<span class="string">"Hello 2!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="5-启动main"><a href="#5-启动main" class="headerlink" title="5. 启动main"></a>5. 启动main</h4><h4 id="6-验证"><a href="#6-验证" class="headerlink" title="6. 验证"></a>6. 验证</h4><p>main方法运行后会直接退出，同时控制台会打印”Hello World!”与”Hello 2!”</p>
<h4 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h4><p>这个干嘛用的？<br>官方叫做短命任务，就是执行一次就结束的任务，用于一些临时处理的代码场景，每次执行都会记录在数据库中执行的结果，正常，异常信息</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SpringCloud文章系列&quot;&gt;&lt;a href=&quot;#SpringCloud文章系列&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud文章系列&quot;&gt;&lt;/a&gt;SpringCloud文章系列&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
      <category term="技术" scheme="https://dawell.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringCloud" scheme="https://dawell.github.io/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>20180501架构设计</title>
    <link href="https://dawell.github.io/2018/08/11/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/"/>
    <id>https://dawell.github.io/2018/08/11/架构设计/</id>
    <published>2018-08-11T02:47:36.000Z</published>
    <updated>2018-08-15T11:33:02.642Z</updated>
    
    <content type="html"><![CDATA[<p>准备介绍内容如下</p>
<ol>
<li>领域驱动</li>
<li>前后端分离</li>
<li>微服务设计</li>
<li>缓存策略</li>
<li>限流策略</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;准备介绍内容如下&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;领域驱动&lt;/li&gt;
&lt;li&gt;前后端分离&lt;/li&gt;
&lt;li&gt;微服务设计&lt;/li&gt;
&lt;li&gt;缓存策略&lt;/li&gt;
&lt;li&gt;限流策略&lt;/li&gt;
&lt;/ol&gt;

    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>SpringCloud-监控管理</title>
    <link href="https://dawell.github.io/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/"/>
    <id>https://dawell.github.io/2018/08/10/SpringCloud-监控管理/</id>
    <published>2018-08-10T07:40:30.000Z</published>
    <updated>2018-08-17T07:54:41.384Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud文章系列"><a href="#SpringCloud文章系列" class="headerlink" title="SpringCloud文章系列"></a>SpringCloud文章系列</h1><ol>
<li><a href="http://dawell.cc/2018/08/01/SpringCloud/" target="_blank" rel="noopener">SpringCloud</a></li>
<li><a href="http://dawell.cc/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-注册中心</a></li>
<li><a href="http://dawell.cc/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-配置中心</a></li>
<li><a href="http://dawell.cc/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" target="_blank" rel="noopener">SpringCloud-链路跟踪</a></li>
<li><a href="http://dawell.cc/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" target="_blank" rel="noopener">SpringCloud-消息总线</a></li>
<li><a href="http://dawell.cc/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/" target="_blank" rel="noopener">SpringCloud-API网关</a></li>
<li><a href="http://dawell.cc/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/" target="_blank" rel="noopener">SpringCloud-异步消息</a></li>
<li><a href="http://dawell.cc/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/" target="_blank" rel="noopener">SpringCloud-同步调用</a></li>
<li><a href="http://dawell.cc/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/" target="_blank" rel="noopener">SpringCloud-断路降级</a></li>
<li>【当前文章】<a href="http://dawell.cc/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">SpringCloud-监控管理</a></li>
<li><a href="http://dawell.cc/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">SpringCloud-番外篇-临时任务</a></li>
<li><a href="http://dawell.cc/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/" target="_blank" rel="noopener">SpringCloud-番外篇-文档生成</a></li>
<li><a href="http://dawell.cc/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">SpringCloud-番外篇-源码解析</a></li>
</ol>
<h3 id="接入说明"><a href="#接入说明" class="headerlink" title="接入说明"></a>接入说明</h3><ol>
<li>目前采用最新的1.xRelease版本：1.5.15.RELEASE</li>
<li>SpringCloud项目可以在start.spring.io下载，不过更方便的应该是通过idea新建项目，建立Spring Initializr项目</li>
<li>我一般习惯将具体实现服务用具体的服务名，而公共组件用service-xxx来命名，当然还有一些比较固定名字的公共组件</li>
</ol>
<h3 id="Admin监控"><a href="#Admin监控" class="headerlink" title="Admin监控"></a>Admin监控</h3><h4 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1. 新建项目"></a>1. 新建项目</h4><p>新建artifactId为service-admin的服务</p>
<h4 id="2-导入依赖"><a href="#2-导入依赖" class="headerlink" title="2. 导入依赖"></a>2. 导入依赖</h4><p>依赖说明</p>
<ol>
<li>actuator用于暴露监控的接口</li>
<li>eureka-server是Eureka服务器的依赖</li>
<li>config是Config客户端，从配置中心拉取配置</li>
<li>admin-starter-server是admin监控平台的依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-编写启动类"><a href="#3-编写启动类" class="headerlink" title="3. 编写启动类"></a>3. 编写启动类</h4><p>打开ServiceAdminApplication，在class上加入@EnableAdminServer注解</p>
<h4 id="4-修改配置"><a href="#4-修改配置" class="headerlink" title="4. 修改配置"></a>4. 修改配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server.port=7088</span><br><span class="line">spring.application.name=service-admin</span><br><span class="line"></span><br><span class="line"># public</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka,http://localhost:8762/eureka</span><br><span class="line">spring.cloud.config.discovery.enabled=true</span><br><span class="line">spring.cloud.config.discovery.service-id=service-config</span><br></pre></td></tr></table></figure>
<h4 id="5-启动main"><a href="#5-启动main" class="headerlink" title="5. 启动main"></a>5. 启动main</h4><h4 id="6-验证"><a href="#6-验证" class="headerlink" title="6. 验证"></a>6. 验证</h4><p>访问 <a href="http://localhost:8761/" target="_blank" rel="noopener">http://localhost:8761/</a> 看到service-admin已经注册了一台<br>访问 <a href="http://localhost:7088" target="_blank" rel="noopener">http://localhost:7088</a>  可以看到admin的列表，首页就是与注册中心信息差不多，全部的应用，还有detail可以点进去看到各个endpoint数据</p>
<h3 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h3><p>admin其实是基于SpringBoot诞生的，在注册中心引入之前本来也是有一个admin的client的，用于发现服务维持心跳的<br>但是基于SpringCloud的注册中心就不需要在客户端依赖了</p>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><h4 id="集成Hystrix大盘"><a href="#集成Hystrix大盘" class="headerlink" title="集成Hystrix大盘"></a>集成Hystrix大盘</h4><p>之前介绍过断路降级的hystrix大盘，其实可以集成在admin中更加方便统一<br>导入依赖<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-server-ui-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-server-ui-turbine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>配置文件中引入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.boot.admin.routes.endpoints=env,metrics,dump,jolokia,info,configprops,trace,logfile,refresh,flyway,liquibase,heapdump,loggers,auditevents,hystrix.stream,turbine.stream,activiti</span><br><span class="line">spring.boot.admin.turbine.location=turbine-service</span><br></pre></td></tr></table></figure></p>
<p>这样打开页面时在每个服务的detail中可以看到hystrix的信息，同时在大菜单上加入了Tuibine的视图</p>
<p>同时有个方便的方式是将turbine服务直接在admin中去集成，不用单独开turbine服务</p>
<h4 id="集成登录验证"><a href="#集成登录验证" class="headerlink" title="集成登录验证"></a>集成登录验证</h4><p>简单的方式引入spring-boot-starter-security即可用basic验证了<br>不过admin也有一个登录界面<br>引入如下<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-server-ui-login<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后建立登录认证的配置<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity</span>(securedEnabled = <span class="keyword">true</span>, prePostEnabled = <span class="keyword">true</span>, proxyTargetClass = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(WebSecurity web)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//忽略css.jq.img等文件</span></span><br><span class="line">        web.ignoring()</span><br><span class="line">                .antMatchers(<span class="string">"/**.html"</span>, <span class="string">"/**.css"</span>, <span class="string">"/img/**"</span>, <span class="string">"/**.js"</span>, <span class="string">"/third-party/**"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        http</span><br><span class="line">                .csrf().disable() <span class="comment">//HTTP with Disable CSRF</span></span><br><span class="line">                .authorizeRequests() <span class="comment">//Authorize Request Configuration</span></span><br><span class="line">                .antMatchers(<span class="string">"/login"</span>,</span><br><span class="line">                        <span class="string">"/api/**"</span>,</span><br><span class="line">                        <span class="string">"/**/heapdump"</span>,</span><br><span class="line">                        <span class="string">"/**/loggers"</span>,</span><br><span class="line">                        <span class="string">"/**/liquibase"</span>,</span><br><span class="line">                        <span class="string">"/**/logfile"</span>,</span><br><span class="line">                        <span class="string">"/**/flyway"</span>,</span><br><span class="line">                        <span class="string">"/**/auditevents"</span>,</span><br><span class="line">                        <span class="string">"/**/jolokia"</span>).permitAll() <span class="comment">//放开"/api/**"：为了给被监控端免登录注册并解决Log与Logger冲突</span></span><br><span class="line">                .and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">"/**"</span>).hasRole(<span class="string">"USER"</span>)</span><br><span class="line">                .antMatchers(<span class="string">"/**"</span>).authenticated()</span><br><span class="line">                .and() <span class="comment">//Login Form configuration for all others</span></span><br><span class="line">                .formLogin()</span><br><span class="line">                .loginPage(<span class="string">"/login.html"</span>)</span><br><span class="line">                .loginProcessingUrl(<span class="string">"/login"</span>).permitAll()</span><br><span class="line">                .defaultSuccessUrl(<span class="string">"/"</span>)</span><br><span class="line">                .and() <span class="comment">//Logout Form configuration</span></span><br><span class="line">                .logout()</span><br><span class="line">                .deleteCookies(<span class="string">"remove"</span>)</span><br><span class="line">                .logoutSuccessUrl(<span class="string">"/login.html"</span>).permitAll()</span><br><span class="line">                .and()</span><br><span class="line">                .httpBasic();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>配置文件中引入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 权限</span><br><span class="line">security.user.name=admin</span><br><span class="line">security.user.password=123</span><br><span class="line">security.basic.enabled=false</span><br></pre></td></tr></table></figure></p>
<p>这样在访问监控时会先要求登录 使用admin与123访问</p>
<h4 id="集成监控报警"><a href="#集成监控报警" class="headerlink" title="集成监控报警"></a>集成监控报警</h4><p>可以在应用状态变更与endpoin异常时自动邮件报警<br>导入<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>配置中需要开启通知与邮件的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">spring.boot.admin.notify.mail.to=456@qq.com</span><br><span class="line">spring.boot.admin.notify.mail.from=123@qq.com</span><br><span class="line">#从任何状态到up状态都不要发邮件通知</span><br><span class="line">#spring.boot.admin.notify.mail.ignore-changes: *:UP</span><br><span class="line"># 邮件</span><br><span class="line">spring.mail.host=smtp.qq.com</span><br><span class="line">spring.mail.username=123@qq.com</span><br><span class="line">spring.mail.password=xxxxx</span><br><span class="line">spring.mail.properties.mail.debug=false</span><br><span class="line">spring.mail.properties.mail.smtp.auth=true</span><br><span class="line">spring.mail.properties.mail.smtp.starttls.enable=true</span><br><span class="line">spring.mail.properties.mail.smtp.starttls.required=true</span><br><span class="line">spring.mail.properties.mail.smtp.ssl.enable=true</span><br><span class="line">spring.mail.port=465</span><br></pre></td></tr></table></figure>
<p>上面配置是开启SSL的邮件配置</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SpringCloud文章系列&quot;&gt;&lt;a href=&quot;#SpringCloud文章系列&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud文章系列&quot;&gt;&lt;/a&gt;SpringCloud文章系列&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
      <category term="技术" scheme="https://dawell.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringCloud" scheme="https://dawell.github.io/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-断路降级</title>
    <link href="https://dawell.github.io/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/"/>
    <id>https://dawell.github.io/2018/08/09/SpringCloud-断路降级/</id>
    <published>2018-08-09T07:39:14.000Z</published>
    <updated>2018-08-17T07:54:41.355Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud文章系列"><a href="#SpringCloud文章系列" class="headerlink" title="SpringCloud文章系列"></a>SpringCloud文章系列</h1><ol>
<li><a href="http://dawell.cc/2018/08/01/SpringCloud/" target="_blank" rel="noopener">SpringCloud</a></li>
<li><a href="http://dawell.cc/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-注册中心</a></li>
<li><a href="http://dawell.cc/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-配置中心</a></li>
<li><a href="http://dawell.cc/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" target="_blank" rel="noopener">SpringCloud-链路跟踪</a></li>
<li><a href="http://dawell.cc/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" target="_blank" rel="noopener">SpringCloud-消息总线</a></li>
<li><a href="http://dawell.cc/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/" target="_blank" rel="noopener">SpringCloud-API网关</a></li>
<li><a href="http://dawell.cc/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/" target="_blank" rel="noopener">SpringCloud-异步消息</a></li>
<li><a href="http://dawell.cc/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/" target="_blank" rel="noopener">SpringCloud-同步调用</a></li>
<li>【当前文章】<a href="http://dawell.cc/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/" target="_blank" rel="noopener">SpringCloud-断路降级</a></li>
<li><a href="http://dawell.cc/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">SpringCloud-监控管理</a></li>
<li><a href="http://dawell.cc/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">SpringCloud-番外篇-临时任务</a></li>
<li><a href="http://dawell.cc/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/" target="_blank" rel="noopener">SpringCloud-番外篇-文档生成</a></li>
<li><a href="http://dawell.cc/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">SpringCloud-番外篇-源码解析</a></li>
</ol>
<h3 id="接入说明"><a href="#接入说明" class="headerlink" title="接入说明"></a>接入说明</h3><ol>
<li>目前采用最新的1.xRelease版本：1.5.15.RELEASE</li>
<li>SpringCloud项目可以在start.spring.io下载，不过更方便的应该是通过idea新建项目，建立Spring Initializr项目</li>
<li>我一般习惯将具体实现服务用具体的服务名，而公共组件用service-xxx来命名，当然还有一些比较固定名字的公共组件</li>
</ol>
<h3 id="断路监控大盘"><a href="#断路监控大盘" class="headerlink" title="断路监控大盘"></a>断路监控大盘</h3><h4 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1. 新建项目"></a>1. 新建项目</h4><p>新建artifactId为hystrix-dashboard的服务</p>
<h4 id="2-导入依赖"><a href="#2-导入依赖" class="headerlink" title="2. 导入依赖"></a>2. 导入依赖</h4><p>依赖说明</p>
<ol>
<li>actuator用于暴露监控的接口</li>
<li>eureka-server是Eureka服务器的依赖</li>
<li>config是Config客户端，从配置中心拉取配置</li>
<li>netflix-hystrix-dashboard是hystrix监控大盘的依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-编写启动类"><a href="#3-编写启动类" class="headerlink" title="3. 编写启动类"></a>3. 编写启动类</h4><p>打开HystrixDashboardApplication，在class上加入@EnableHystrixDashboard注解</p>
<h4 id="4-修改配置"><a href="#4-修改配置" class="headerlink" title="4. 修改配置"></a>4. 修改配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server.port=8030</span><br><span class="line">spring.application.name=hystrix-dashboard</span><br><span class="line"></span><br><span class="line"># public</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka,http://localhost:8762/eureka</span><br><span class="line">spring.cloud.config.discovery.enabled=true</span><br><span class="line">spring.cloud.config.discovery.service-id=service-config</span><br></pre></td></tr></table></figure>
<h4 id="5-启动main"><a href="#5-启动main" class="headerlink" title="5. 启动main"></a>5. 启动main</h4><h4 id="6-验证"><a href="#6-验证" class="headerlink" title="6. 验证"></a>6. 验证</h4><p>访问 <a href="http://localhost:8761/" target="_blank" rel="noopener">http://localhost:8761/</a> 看到hystrix-dashboard已经注册了一台<br>访问 <a href="http://localhost:8030" target="_blank" rel="noopener">http://localhost:8030</a>  可以看到hystrix监控的页面，上面需要配置一个xxx.stream的http地址，客户度集成后就有这个地址了</p>
<h3 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h3><p>基于刚同步调用章节business-service服务调用account-service服务接口的例子</p>
<h4 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-开启注解"><a href="#2-开启注解" class="headerlink" title="2. 开启注解"></a>2. 开启注解</h4><p>BusinessServiceApplication加入注解 @EnableCircuitBreaker 打开断路器功能</p>
<h4 id="3-修改代码"><a href="#3-修改代码" class="headerlink" title="3. 修改代码"></a>3. 修改代码</h4><p>基于feign远程调用的降级非常简单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountRead accountRead;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">fallback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"掛了"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@HystrixCommand</span>(fallbackMethod = <span class="string">"fallback"</span>)</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/account-msg"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountRead.read();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>增加@HystrixCommand注解，注解种指定fallbackMethod对应同参数与返回值的方法即可</p>
<p>其他的方法也可以在方法上面标注@HystrixCommand(fallbackMethod = “xxx”)注解就实现降级了，比如用restTempldate请求的方法上加上</p>
<h3 id="监控大盘集成"><a href="#监控大盘集成" class="headerlink" title="监控大盘集成"></a>监控大盘集成</h3><p>只需将客户的的<a href="http://localhost:8010/hystrix.stream填入hystrix-dashboard的url中点击下面按钮注册就可以看到监控数据" target="_blank" rel="noopener">http://localhost:8010/hystrix.stream填入hystrix-dashboard的url中点击下面按钮注册就可以看到监控数据</a><br>但是这样只能看到一台机器的，有时候我们想关注整个集群的情况，多个业务服务的链路情况，则需要使用数据聚合服务turbine-service</p>
<h4 id="turbine服务"><a href="#turbine服务" class="headerlink" title="turbine服务"></a>turbine服务</h4><p>导入依赖<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-turbine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>添加bootstrap.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server.port=8001</span><br><span class="line">spring.application.name=turbine-service</span><br><span class="line"></span><br><span class="line"># private</span><br><span class="line">turbine.app-config=api-gateway,business-service</span><br><span class="line">turbine.aggregator.clusterConfig=default</span><br><span class="line">turbine.cluster-name-expression=&quot;default&quot;</span><br><span class="line">turbine.combine-host-port=true</span><br><span class="line"></span><br><span class="line"># public</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka,http://localhost:8762/eureka</span><br><span class="line">spring.cloud.config.discovery.enabled=true</span><br><span class="line">spring.cloud.config.discovery.service-id=service-config</span><br></pre></td></tr></table></figure></p>
<p>turbine.app-config用于指定具体聚合哪些服务，这里聚合2个有调用请求的服务网关+business服务</p>
<p>在TurbineServiceApplication类上加入@EnableTurbine</p>
<p>将地址 <a href="http://localhost:8001/hystrix.stream" target="_blank" rel="noopener">http://localhost:8001/hystrix.stream</a> 配置在hystrix-dashboard上就可以看到服务网关+business服务2个集群的调用情况了</p>
<h3 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h3><h4 id="如果触发了断路器一定是调用服务不可用么？"><a href="#如果触发了断路器一定是调用服务不可用么？" class="headerlink" title="如果触发了断路器一定是调用服务不可用么？"></a>如果触发了断路器一定是调用服务不可用么？</h4><p>不是，因为断路器触发不止远程服务不可行，包括调用异常的情况，只要是异常都会触发断路，比如bug导致的</p>
<h4 id="如果fallback代码报错了呢？"><a href="#如果fallback代码报错了呢？" class="headerlink" title="如果fallback代码报错了呢？"></a>如果fallback代码报错了呢？</h4><p>fallback报错了会抛出一个异常，而fallback一般都是简单的返回默认值固定值的逻辑，如果担心这里处理也有问题，可以在fallback上再加上@HystrixCommand降级<br>可以这样一直降级下去</p>
<h3 id="其他注册中心"><a href="#其他注册中心" class="headerlink" title="其他注册中心"></a>其他注册中心</h3><p>其他更多的是限流的方案与设置调用超时与trycatch的简单处理方案，相对不是太灵活，这里不展开了</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SpringCloud文章系列&quot;&gt;&lt;a href=&quot;#SpringCloud文章系列&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud文章系列&quot;&gt;&lt;/a&gt;SpringCloud文章系列&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
      <category term="技术" scheme="https://dawell.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringCloud" scheme="https://dawell.github.io/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-同步调用</title>
    <link href="https://dawell.github.io/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/"/>
    <id>https://dawell.github.io/2018/08/08/SpringCloud-同步调用/</id>
    <published>2018-08-08T07:37:43.000Z</published>
    <updated>2018-08-17T07:54:41.476Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud文章系列"><a href="#SpringCloud文章系列" class="headerlink" title="SpringCloud文章系列"></a>SpringCloud文章系列</h1><ol>
<li><a href="http://dawell.cc/2018/08/01/SpringCloud/" target="_blank" rel="noopener">SpringCloud</a></li>
<li><a href="http://dawell.cc/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-注册中心</a></li>
<li><a href="http://dawell.cc/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-配置中心</a></li>
<li><a href="http://dawell.cc/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" target="_blank" rel="noopener">SpringCloud-链路跟踪</a></li>
<li><a href="http://dawell.cc/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" target="_blank" rel="noopener">SpringCloud-消息总线</a></li>
<li><a href="http://dawell.cc/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/" target="_blank" rel="noopener">SpringCloud-API网关</a></li>
<li><a href="http://dawell.cc/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/" target="_blank" rel="noopener">SpringCloud-异步消息</a></li>
<li>【当前文章】<a href="http://dawell.cc/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/" target="_blank" rel="noopener">SpringCloud-同步调用</a></li>
<li><a href="http://dawell.cc/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/" target="_blank" rel="noopener">SpringCloud-断路降级</a></li>
<li><a href="http://dawell.cc/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">SpringCloud-监控管理</a></li>
<li><a href="http://dawell.cc/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">SpringCloud-番外篇-临时任务</a></li>
<li><a href="http://dawell.cc/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/" target="_blank" rel="noopener">SpringCloud-番外篇-文档生成</a></li>
<li><a href="http://dawell.cc/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">SpringCloud-番外篇-源码解析</a></li>
</ol>
<h3 id="接入说明"><a href="#接入说明" class="headerlink" title="接入说明"></a>接入说明</h3><ol>
<li>目前采用最新的1.xRelease版本：1.5.15.RELEASE</li>
<li>SpringCloud项目可以在start.spring.io下载，不过更方便的应该是通过idea新建项目，建立Spring Initializr项目</li>
<li>我一般习惯将具体实现服务用具体的服务名，而公共组件用service-xxx来命名，当然还有一些比较固定名字的公共组件</li>
<li>基于配置中心，请先按照配置中心章节，配置公共配置</li>
<li>依赖链路追踪章节</li>
</ol>
<h3 id="同步调用"><a href="#同步调用" class="headerlink" title="同步调用"></a>同步调用</h3><p>同步调用主要是通过HTTP去请求的，这里演示Feign的调用，重点在客户端的实现，服务端暴露接口就是普通的SpringMVC的使用</p>
<h4 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1. 新建项目"></a>1. 新建项目</h4><p>继续使用”异步调用”章节的artifactId为account-service的服务</p>
<h4 id="2-导入依赖"><a href="#2-导入依赖" class="headerlink" title="2. 导入依赖"></a>2. 导入依赖</h4><p>依赖说明</p>
<ol>
<li>可以显示引入web的依赖</li>
<li>actuator与eureka-server已经依赖web，其实SC中大部分组件已经强依赖web了，依赖这些组件可以不显示依赖（不过建议还是明确引入）</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-编写服务端暴露接口"><a href="#3-编写服务端暴露接口" class="headerlink" title="3. 编写服务端暴露接口"></a>3. 编写服务端暴露接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MessageController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MessageController</span><span class="params">(@Value(<span class="string">"$&#123;message&#125;"</span>)</span> String msg)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/msg"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个接口还是使用配置中心章节使用的/msg接口暴露服务</p>
<h4 id="4-启动main"><a href="#4-启动main" class="headerlink" title="4. 启动main"></a>4. 启动main</h4><h4 id="5-验证"><a href="#5-验证" class="headerlink" title="5. 验证"></a>5. 验证</h4><p>访问<a href="http://localhost:8020/msg" target="_blank" rel="noopener">http://localhost:8020/msg</a> 可以返回配置中心的msg配置数据</p>
<h3 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h3><p>客户端使用项目business-service演示</p>
<h4 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-feign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-开启注解"><a href="#2-开启注解" class="headerlink" title="2. 开启注解"></a>2. 开启注解</h4><p>BusinessServiceApplication上加入@EnableFeignClients开启Feign</p>
<h4 id="3-添加调用代码"><a href="#3-添加调用代码" class="headerlink" title="3. 添加调用代码"></a>3. 添加调用代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient</span>(<span class="string">"account-service"</span>)</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">AccountRead</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(method = RequestMethod.GET, value = <span class="string">"/msg"</span>)</span><br><span class="line">    <span class="function">String <span class="title">read</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountRead accountRead;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/account-msg"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> accountRead.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之前在account-service中声明的/msg接口在这里使用同样的SpringMVC的注解标注AccountRead接口接口代表远程调用的客户端<br>然后调用时只需要@Autowired注入即可使用</p>
<h3 id="其他同步调用方式"><a href="#其他同步调用方式" class="headerlink" title="其他同步调用方式"></a>其他同步调用方式</h3><p>如restfulTemplate也可以远程调用，不过不如feign方便，需要拼请求参数的URL，当前例子因为不需要拼接参数，所以看起来差不多</p>
<h4 id="快速接入"><a href="#快速接入" class="headerlink" title="快速接入"></a>快速接入</h4><p>在main类或者config类中构建一个RestTemplate，标记@LoadBalanced，则会采用Ribbon提供的负载均衡算法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController2</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/account-msg"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(<span class="string">"http://account-service/msg"</span>, String.class);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h3><h4 id="如果返回的不是String，而是一个对象呢？"><a href="#如果返回的不是String，而是一个对象呢？" class="headerlink" title="如果返回的不是String，而是一个对象呢？"></a>如果返回的不是String，而是一个对象呢？</h4><p>对象只需要在客户端这里声明一个类似的对象即可自动转换，其实中间数据都是用json传输的，类名可以不一样，只要属性一样即可匹配</p>
<h4 id="请求调用的IP与端口号我想获取或者单独控制怎么实现？"><a href="#请求调用的IP与端口号我想获取或者单独控制怎么实现？" class="headerlink" title="请求调用的IP与端口号我想获取或者单独控制怎么实现？"></a>请求调用的IP与端口号我想获取或者单独控制怎么实现？</h4><p>Feign其实是依赖Ribbon去做负载均衡的，可以在配置中配置负载均衡策略<br>具体获取请求IP与端口控制可以直接使用Ribbon去请求可以获取到负载的IP与端口号，结合RestfulTempldate去请求服务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoadBalancerClient client;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/account-msg2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">read2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ServiceInstance serviceInstance = client.choose(<span class="string">"account-service"</span>);</span><br><span class="line">        String url = <span class="string">"http://"</span> + serviceInstance.getHost() + <span class="string">":"</span> + serviceInstance.getPort() + <span class="string">"/msg"</span>;</span><br><span class="line">        <span class="keyword">return</span> restTemplate.getForObject(url, String.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SpringCloud文章系列&quot;&gt;&lt;a href=&quot;#SpringCloud文章系列&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud文章系列&quot;&gt;&lt;/a&gt;SpringCloud文章系列&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
      <category term="技术" scheme="https://dawell.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringCloud" scheme="https://dawell.github.io/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-异步消息</title>
    <link href="https://dawell.github.io/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/"/>
    <id>https://dawell.github.io/2018/08/07/SpringCloud-异步消息/</id>
    <published>2018-08-07T07:24:31.000Z</published>
    <updated>2018-08-20T03:52:56.764Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud文章系列"><a href="#SpringCloud文章系列" class="headerlink" title="SpringCloud文章系列"></a>SpringCloud文章系列</h1><ol>
<li><a href="http://dawell.cc/2018/08/01/SpringCloud/" target="_blank" rel="noopener">SpringCloud</a></li>
<li><a href="http://dawell.cc/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-注册中心</a></li>
<li><a href="http://dawell.cc/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-配置中心</a></li>
<li><a href="http://dawell.cc/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" target="_blank" rel="noopener">SpringCloud-链路跟踪</a></li>
<li><a href="http://dawell.cc/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" target="_blank" rel="noopener">SpringCloud-消息总线</a></li>
<li><a href="http://dawell.cc/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/" target="_blank" rel="noopener">SpringCloud-API网关</a></li>
<li>【当前文章】<a href="http://dawell.cc/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/" target="_blank" rel="noopener">SpringCloud-异步消息</a></li>
<li><a href="http://dawell.cc/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/" target="_blank" rel="noopener">SpringCloud-同步调用</a></li>
<li><a href="http://dawell.cc/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/" target="_blank" rel="noopener">SpringCloud-断路降级</a></li>
<li><a href="http://dawell.cc/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">SpringCloud-监控管理</a></li>
<li><a href="http://dawell.cc/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">SpringCloud-番外篇-临时任务</a></li>
<li><a href="http://dawell.cc/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/" target="_blank" rel="noopener">SpringCloud-番外篇-文档生成</a></li>
<li><a href="http://dawell.cc/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">SpringCloud-番外篇-源码解析</a></li>
</ol>
<h3 id="接入说明"><a href="#接入说明" class="headerlink" title="接入说明"></a>接入说明</h3><ol>
<li>目前采用最新的1.xRelease版本：1.5.15.RELEASE</li>
<li>SpringCloud项目可以在start.spring.io下载，不过更方便的应该是通过idea新建项目，建立Spring Initializr项目</li>
<li>我一般习惯将具体实现服务用具体的服务名，而公共组件用service-xxx来命名，当然还有一些比较固定名字的公共组件</li>
<li>基于配置中心，请先按照配置中心章节，配置公共配置</li>
<li>依赖链路追踪章节</li>
</ol>
<h3 id="Stream-Kafka"><a href="#Stream-Kafka" class="headerlink" title="Stream-Kafka"></a>Stream-Kafka</h3><h4 id="0-搭建kafka"><a href="#0-搭建kafka" class="headerlink" title="0. 搭建kafka"></a>0. 搭建kafka</h4><p>详见中间件kafka章节</p>
<h4 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1. 新建项目"></a>1. 新建项目</h4><p>新建artifactId为account-service的服务</p>
<h4 id="2-导入依赖"><a href="#2-导入依赖" class="headerlink" title="2. 导入依赖"></a>2. 导入依赖</h4><p>依赖说明</p>
<ol>
<li>actuator用于暴露监控的接口</li>
<li>eureka是Eureka客户端，注册到注册中心</li>
<li>config是Config客户端，从配置中心拉取配置</li>
<li>sleuth + zipkin是链路追踪客户端，用于监控链路调用</li>
<li>bus-kafka是基于kafka的bus消息总线客户端，用于接收消息总线异步事件</li>
<li>stream + stream-binder-kafka + spring-kafka配置的是kafka的发送/消费端依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-sleuth<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-stream<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-stream-binder-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-编写启动类"><a href="#3-编写启动类" class="headerlink" title="3. 编写启动类"></a>3. 编写启动类</h4><p>打开AccountServiceApplication，在class上加入@EnableBinding(Source.class)注解</p>
<h4 id="4-修改配置"><a href="#4-修改配置" class="headerlink" title="4. 修改配置"></a>4. 修改配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server.port=8020</span><br><span class="line">spring.application.name=account-service</span><br><span class="line"></span><br><span class="line">private</span><br><span class="line">spring.cloud.stream.bindings.output.destination=accounts</span><br><span class="line"></span><br><span class="line">#kafka</span><br><span class="line">spring.cloud.stream.kafka.binder.zk-nodes=localhost:2181</span><br><span class="line">spring.cloud.stream.kafka.binder.brokers=localhost:9092</span><br></pre></td></tr></table></figure>
<p>stream.bindings.output.destination主要是配置kafka发送端的topic</p>
<h4 id="5-编写调用代码"><a href="#5-编写调用代码" class="headerlink" title="5. 编写调用代码"></a>5. 编写调用代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MessageController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Source source;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"/accounts"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(@RequestBody Account account)</span> </span>&#123;</span><br><span class="line">        source.output().send(MessageBuilder.withPayload(account.getMob()).build());</span><br><span class="line">        log.info(<span class="string">"kafka send!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>暴露一个/accounts接口，提交POST方法请求，传递包含mob字段的json数据，会将mob字段作为kafka消息体发送<br>其中Source直接注入即可，Source是Stream自带的接口类，默认Source中的配置关联到”output”中，刚才配置了output的destination也就是topic是accounts</p>
<h4 id="6-启动main"><a href="#6-启动main" class="headerlink" title="6. 启动main"></a>6. 启动main</h4><h4 id="7-验证"><a href="#7-验证" class="headerlink" title="7. 验证"></a>7. 验证</h4><p>可以打开一个控制台，通过kafka-console-consumer.sh/bat去监听accounts的topic的kafka<br>通过暴露/accounts接口post提交信息，通过kafka-console-consumer.sh/bat控台可以看到消息结构<br>stream会自动封装一个content-type类型，用于标识数据类型</p>
<h3 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h3><h4 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-stream<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-stream-binder-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>stream + stream-binder-kafka + spring-kafka配置的是kafka的发送/消费端依赖<br>这个配置与发送端是一样的</p>
<h4 id="2-开启注解"><a href="#2-开启注解" class="headerlink" title="2. 开启注解"></a>2. 开启注解</h4><p>BusinessServiceApplication添加@EnableBinding(Sink.class)</p>
<p>Sink用于接收kafka，当然如果是多个kafkaTopic这里可以设置多个，接口都是继承了Sink接口，也可以在一个接口中声明多个SubscribableChannel与注解如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomSink</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String INPUT = <span class="string">"input3"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Input</span>(INPUT)</span><br><span class="line">    <span class="function">SubscribableChannel <span class="title">input</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    String INPUT0 = <span class="string">"input0"</span>;</span><br><span class="line"></span><br><span class="line">    String INPUT1 = <span class="string">"input1"</span>;</span><br><span class="line"></span><br><span class="line">    String INPUT2 = <span class="string">"input2"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Input</span>(INPUT0)</span><br><span class="line">    <span class="function">SubscribableChannel <span class="title">input0</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Input</span>(INPUT1)</span><br><span class="line">    <span class="function">SubscribableChannel <span class="title">input1</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Input</span>(INPUT2)</span><br><span class="line">    <span class="function">SubscribableChannel <span class="title">input2</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="3-修改配置"><a href="#3-修改配置" class="headerlink" title="3. 修改配置"></a>3. 修改配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.stream.bindings.input.destination=accounts</span><br><span class="line">#spring.kafka.listener.poll-timeout=</span><br></pre></td></tr></table></figure>
<p>这里是接收端，所以是input<br>headerMode用于配置是stream的格式还是原始数据<br>content-type用于配置数据解析类型</p>
<p>注意：如果通过kafka的kafka-console-producer.bat模拟发送kafka的时候，消费端会报如下错误<br>    could not convert messages from Kafka异常<br>原因就是因为发送的内容不是stream发送出来的，stream有其固定的格式，至少要有content-type属性<br>如果想不用stream格式发送也能解析需要在消费方增加如下配置，进行raw源数据的解析<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.stream.bindings.input.consumer.headerMode=raw</span><br><span class="line">spring.cloud.stream.bindings.input.content-type=text/plain</span><br></pre></td></tr></table></figure></p>
<h4 id="4-接收消息代码"><a href="#4-接收消息代码" class="headerlink" title="4. 接收消息代码"></a>4. 接收消息代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountConsumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StreamListener</span>(Sink.INPUT)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        log.info(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@StreamListener注解用于标识处理消息的方法</p>
<h3 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h3><h4 id="Stream是怎么保存链路追踪的数据的？"><a href="#Stream是怎么保存链路追踪的数据的？" class="headerlink" title="Stream是怎么保存链路追踪的数据的？"></a>Stream是怎么保存链路追踪的数据的？</h4><p>如果不引入sleuth + zipkin依赖，保存的消息格式只是带有content-type字段，而如果引入了这2个依赖就会在Stream消息格式里加入额外4个字段</p>
<ol>
<li>traceId</li>
<li>spanId</li>
</ol>
<p>消息体会变大，不过带来的好处是消息消费的时候依然可以记录链路信息，这样在链路图上就可以看到所有消息者消费的情况了</p>
<h4 id="支持kafka的消息组及消息分区"><a href="#支持kafka的消息组及消息分区" class="headerlink" title="支持kafka的消息组及消息分区"></a>支持kafka的消息组及消息分区</h4><p>在生产端需要增加分区规则与个数的配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.stream.bindings.output.producer.partitionKeyExpression=payload</span><br><span class="line">spring.cloud.stream.bindings.output.producer.partitionCount=2</span><br></pre></td></tr></table></figure></p>
<p>partitionKeyExpression可以使用SpEL去解析具体传输数据体中的某个key值去作为分区key<br>partitionCount指定分区的总个数</p>
<p>在消费端也需要开启分区配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.stream.bindings.input.comsumer.partitioned=true</span><br><span class="line">spring.cloud.stream.instanceCount=2</span><br><span class="line">spring.cloud.stream.instanceIndex=0</span><br></pre></td></tr></table></figure></p>
<p>指定总分区个数与当然消费的分区</p>
<p>而消费端如果要指定消费组只需要指定消费组的名称即可开启<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.stream.bindings.input.group=comsumer1</span><br></pre></td></tr></table></figure></p>
<p>不加消费组每个订阅者都收到同样的消息，offset独立维护<br>消费组能保证所有组内消费同一topic中的消息只有一个组内的服务消费，串性消费，offset维护在公共区域，Stream默认存储在zookeeper中</p>
<p>在kafka中的zookeeper中存储个位置：/consumers/组名/offsets/主题/分区移动的位置</p>
<h3 id="其他注册中心"><a href="#其他注册中心" class="headerlink" title="其他注册中心"></a>其他注册中心</h3><p>其他还有RabbitMQ的实现</p>
<h4 id="快速接入"><a href="#快速接入" class="headerlink" title="快速接入"></a>快速接入</h4><p>略…</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SpringCloud文章系列&quot;&gt;&lt;a href=&quot;#SpringCloud文章系列&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud文章系列&quot;&gt;&lt;/a&gt;SpringCloud文章系列&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
      <category term="技术" scheme="https://dawell.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringCloud" scheme="https://dawell.github.io/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-API网关</title>
    <link href="https://dawell.github.io/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/"/>
    <id>https://dawell.github.io/2018/08/06/SpringCloud-API网关/</id>
    <published>2018-08-06T12:21:35.000Z</published>
    <updated>2018-08-17T07:54:41.407Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud文章系列"><a href="#SpringCloud文章系列" class="headerlink" title="SpringCloud文章系列"></a>SpringCloud文章系列</h1><ol>
<li><a href="http://dawell.cc/2018/08/01/SpringCloud/" target="_blank" rel="noopener">SpringCloud</a></li>
<li><a href="http://dawell.cc/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-注册中心</a></li>
<li><a href="http://dawell.cc/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-配置中心</a></li>
<li><a href="http://dawell.cc/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" target="_blank" rel="noopener">SpringCloud-链路跟踪</a></li>
<li><a href="http://dawell.cc/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" target="_blank" rel="noopener">SpringCloud-消息总线</a></li>
<li>【当前文章】<a href="http://dawell.cc/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/" target="_blank" rel="noopener">SpringCloud-API网关</a></li>
<li><a href="http://dawell.cc/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/" target="_blank" rel="noopener">SpringCloud-异步消息</a></li>
<li><a href="http://dawell.cc/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/" target="_blank" rel="noopener">SpringCloud-同步调用</a></li>
<li><a href="http://dawell.cc/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/" target="_blank" rel="noopener">SpringCloud-断路降级</a></li>
<li><a href="http://dawell.cc/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">SpringCloud-监控管理</a></li>
<li><a href="http://dawell.cc/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">SpringCloud-番外篇-临时任务</a></li>
<li><a href="http://dawell.cc/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/" target="_blank" rel="noopener">SpringCloud-番外篇-文档生成</a></li>
<li><a href="http://dawell.cc/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">SpringCloud-番外篇-源码解析</a></li>
</ol>
<h3 id="接入说明"><a href="#接入说明" class="headerlink" title="接入说明"></a>接入说明</h3><ol>
<li>目前采用最新的1.xRelease版本：1.5.15.RELEASE</li>
<li>SpringCloud项目可以在start.spring.io下载，不过更方便的应该是通过idea新建项目，建立Spring Initializr项目</li>
<li>我一般习惯将具体实现服务用具体的服务名，而公共组件用service-xxx来命名，当然还有一些比较固定名字的公共组件</li>
<li>基于配置中心，请先按照配置中心章节，配置公共配置</li>
<li>依赖链路追踪章节</li>
</ol>
<h3 id="API网关"><a href="#API网关" class="headerlink" title="API网关"></a>API网关</h3><h4 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1. 新建项目"></a>1. 新建项目</h4><p>新建artifactId为api-gateway的服务</p>
<h4 id="2-导入依赖"><a href="#2-导入依赖" class="headerlink" title="2. 导入依赖"></a>2. 导入依赖</h4><p>依赖说明</p>
<ol>
<li>actuator用于暴露监控的接口</li>
<li>eureka是Eureka客户端，注册到注册中心</li>
<li>config是Config客户端，从配置中心拉取配置</li>
<li>sleuth + zipkin是链路追踪客户端，用于监控链路调用</li>
<li>bus-kafka是基于kafka的bus消息总线客户端，用于接收消息总线异步事件</li>
<li>zuul是zuul网关的依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-sleuth<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zuul<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-编写启动类"><a href="#3-编写启动类" class="headerlink" title="3. 编写启动类"></a>3. 编写启动类</h4><p>打开ApiGatewayApplication，在class上加入@EnableZuulProxy注解</p>
<h4 id="4-修改配置"><a href="#4-修改配置" class="headerlink" title="4. 修改配置"></a>4. 修改配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server.port=9998</span><br><span class="line">spring.application.name=api-gateway</span><br><span class="line"></span><br><span class="line">#private</span><br><span class="line">feign.httpclient.connection-timeout=3000</span><br><span class="line"></span><br><span class="line">#public 注册中心+配置中心+链路追踪+BUSkafka</span><br></pre></td></tr></table></figure>
<p>feign.httpclient.connection-timeout：API网关依赖Fegion客户端，而API调用时可能超时，一般远程调用的时间需要调整下</p>
<h4 id="5-启动main"><a href="#5-启动main" class="headerlink" title="5. 启动main"></a>5. 启动main</h4><h4 id="6-验证"><a href="#6-验证" class="headerlink" title="6. 验证"></a>6. 验证</h4><p>访问 <a href="http://localhost:8761/" target="_blank" rel="noopener">http://localhost:8761/</a> 看到api-gateway已经注册了一台<br>访问 <a href="http://localhost:9998/应用名/接口名" target="_blank" rel="noopener">http://localhost:9998/应用名/接口名</a>  即可验证，被代理的接口是否调用成功</p>
<h3 id="API网关集群"><a href="#API网关集群" class="headerlink" title="API网关集群"></a>API网关集群</h3><p>只要配置2个端口区分开即可，如9998,9999</p>
<h3 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h3><p>启动代理后就可以通过代理访问请求了，所以无客户端</p>
<h3 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h3><h3 id="其他API网关"><a href="#其他API网关" class="headerlink" title="其他API网关"></a>其他API网关</h3><p>目前还有SpringCLoud亲儿子，基于SpringBoot2的SpringCloud API Gateway</p>
<h4 id="快速接入"><a href="#快速接入" class="headerlink" title="快速接入"></a>快速接入</h4><p>略…</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SpringCloud文章系列&quot;&gt;&lt;a href=&quot;#SpringCloud文章系列&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud文章系列&quot;&gt;&lt;/a&gt;SpringCloud文章系列&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
      <category term="技术" scheme="https://dawell.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringCloud" scheme="https://dawell.github.io/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-消息总线</title>
    <link href="https://dawell.github.io/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/"/>
    <id>https://dawell.github.io/2018/08/05/SpringCloud-消息总线/</id>
    <published>2018-08-05T06:57:18.000Z</published>
    <updated>2018-08-17T07:54:41.502Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud文章系列"><a href="#SpringCloud文章系列" class="headerlink" title="SpringCloud文章系列"></a>SpringCloud文章系列</h1><ol>
<li><a href="http://dawell.cc/2018/08/01/SpringCloud/" target="_blank" rel="noopener">SpringCloud</a></li>
<li><a href="http://dawell.cc/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-注册中心</a></li>
<li><a href="http://dawell.cc/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-配置中心</a></li>
<li><a href="http://dawell.cc/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" target="_blank" rel="noopener">SpringCloud-链路跟踪</a></li>
<li>【当前文章】<a href="http://dawell.cc/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" target="_blank" rel="noopener">SpringCloud-消息总线</a></li>
<li><a href="http://dawell.cc/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/" target="_blank" rel="noopener">SpringCloud-API网关</a></li>
<li><a href="http://dawell.cc/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/" target="_blank" rel="noopener">SpringCloud-异步消息</a></li>
<li><a href="http://dawell.cc/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/" target="_blank" rel="noopener">SpringCloud-同步调用</a></li>
<li><a href="http://dawell.cc/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/" target="_blank" rel="noopener">SpringCloud-断路降级</a></li>
<li><a href="http://dawell.cc/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">SpringCloud-监控管理</a></li>
<li><a href="http://dawell.cc/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">SpringCloud-番外篇-临时任务</a></li>
<li><a href="http://dawell.cc/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/" target="_blank" rel="noopener">SpringCloud-番外篇-文档生成</a></li>
<li><a href="http://dawell.cc/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">SpringCloud-番外篇-源码解析</a></li>
</ol>
<h3 id="接入说明"><a href="#接入说明" class="headerlink" title="接入说明"></a>接入说明</h3><ol>
<li>目前采用最新的1.xRelease版本：1.5.15.RELEASE</li>
<li>SpringCloud项目可以在start.spring.io下载，不过更方便的应该是通过idea新建项目，建立Spring Initializr项目</li>
<li>我一般习惯将具体实现服务用具体的服务名，而公共组件用service-xxx来命名，当然还有一些比较固定名字的公共组件</li>
<li>基于配置中心，请先按照配置中心章节，配置公共配置</li>
<li>依赖链路追踪章节</li>
</ol>
<h3 id="Bus"><a href="#Bus" class="headerlink" title="Bus"></a>Bus</h3><h4 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1. 新建项目"></a>1. 新建项目</h4><p>新建artifactId为service-bus的服务</p>
<h4 id="2-导入依赖"><a href="#2-导入依赖" class="headerlink" title="2. 导入依赖"></a>2. 导入依赖</h4><p>依赖说明</p>
<ol>
<li>actuator用于暴露监控的接口</li>
<li>eureka是Eureka客户端，注册到注册中心</li>
<li>config是Config客户端，从配置中心拉取配置</li>
<li>sleuth + zipkin是链路追踪客户端，用于监控链路调用</li>
<li>bus-kafka是基于kafka的bus消息总线客户端，用于接收消息总线异步事件</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-sleuth<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-编写启动类"><a href="#3-编写启动类" class="headerlink" title="3. 编写启动类"></a>3. 编写启动类</h4><p>不需要添加任何注解，bus依赖进来后扩展了SpringBoot的endpoint</p>
<h4 id="4-修改配置"><a href="#4-修改配置" class="headerlink" title="4. 修改配置"></a>4. 修改配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server.port=8901</span><br><span class="line">spring.application.name=service-bus</span><br><span class="line"></span><br><span class="line">## private</span><br><span class="line">spring.cloud.bus.trace.enabled=true</span><br><span class="line"></span><br><span class="line">#public</span><br><span class="line">spring.cloud.stream.kafka.binder.zk-nodes=localhost:2181</span><br><span class="line">spring.cloud.stream.kafka.binder.brokers=localhost:9092</span><br></pre></td></tr></table></figure>
<p>bus.trace.enabled可以开启bus操作的链路跟踪，每次客户端处理都是异步接收消息去处理的，所以可以观察到每个客户端接收消息时间与ack的情况<br>由于bus依赖于异步消息Stream，这里采用kafka，所以需要配置下kafka的zk与brokers的地址（这里可以看下之前kafka搭建的文章）</p>
<h4 id="5-启动main"><a href="#5-启动main" class="headerlink" title="5. 启动main"></a>5. 启动main</h4><h4 id="6-验证"><a href="#6-验证" class="headerlink" title="6. 验证"></a>6. 验证</h4><p>访问 <a href="http://localhost:8761/" target="_blank" rel="noopener">http://localhost:8761/</a> 看到service-bus已经注册了一台<br>使用curl或者Postman用POST方式访问 <a href="http://localhost:8901/bus/refresh" target="_blank" rel="noopener">http://localhost:8901/bus/refresh</a> 可以通过/trace看到每台机器ack的情况<br>如果开启了链路追踪，也可以通过链路追踪看到每次bus请求的情况</p>
<h3 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h3><h4 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bus-kafka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-开启注解"><a href="#2-开启注解" class="headerlink" title="2. 开启注解"></a>2. 开启注解</h4><p>无注解，引入依赖既开启</p>
<h4 id="3-修改配置"><a href="#3-修改配置" class="headerlink" title="3. 修改配置"></a>3. 修改配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#kafka</span><br><span class="line">spring.cloud.stream.kafka.binder.zk-nodes=localhost:2181</span><br><span class="line">spring.cloud.stream.kafka.binder.brokers=localhost:9092</span><br></pre></td></tr></table></figure>
<p>依赖kafka，与服务端统一kafka</p>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><ol>
<li>通过bus调用的命令不加参数是全局的，可以通过增加destination参数，如/bus/refresh?destination=business-service:**，只会请求business-service的所有服务</li>
<li>如果访问出现401，则配置需要加上management.security.enabled=false</li>
<li>很多BUS功能单一，一般主要与配置中心配合，所以往往BUS的功能可以直接集成在配置中心中，方便管理</li>
</ol>
<h3 id="其他消息总线"><a href="#其他消息总线" class="headerlink" title="其他消息总线"></a>其他消息总线</h3><p>除了kafka的支持，还可以通过rabbitMQ</p>
<h4 id="快速接入"><a href="#快速接入" class="headerlink" title="快速接入"></a>快速接入</h4><p>略…</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SpringCloud文章系列&quot;&gt;&lt;a href=&quot;#SpringCloud文章系列&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud文章系列&quot;&gt;&lt;/a&gt;SpringCloud文章系列&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
      <category term="技术" scheme="https://dawell.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringCloud" scheme="https://dawell.github.io/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-链路跟踪</title>
    <link href="https://dawell.github.io/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/"/>
    <id>https://dawell.github.io/2018/08/04/SpringCloud-链路跟踪/</id>
    <published>2018-08-04T03:51:52.000Z</published>
    <updated>2018-08-17T07:54:41.430Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud文章系列"><a href="#SpringCloud文章系列" class="headerlink" title="SpringCloud文章系列"></a>SpringCloud文章系列</h1><ol>
<li><a href="http://dawell.cc/2018/08/01/SpringCloud/" target="_blank" rel="noopener">SpringCloud</a></li>
<li><a href="http://dawell.cc/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-注册中心</a></li>
<li><a href="http://dawell.cc/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-配置中心</a></li>
<li>【当前文章】<a href="http://dawell.cc/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" target="_blank" rel="noopener">SpringCloud-链路跟踪</a></li>
<li><a href="http://dawell.cc/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" target="_blank" rel="noopener">SpringCloud-消息总线</a></li>
<li><a href="http://dawell.cc/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/" target="_blank" rel="noopener">SpringCloud-API网关</a></li>
<li><a href="http://dawell.cc/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/" target="_blank" rel="noopener">SpringCloud-异步消息</a></li>
<li><a href="http://dawell.cc/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/" target="_blank" rel="noopener">SpringCloud-同步调用</a></li>
<li><a href="http://dawell.cc/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/" target="_blank" rel="noopener">SpringCloud-断路降级</a></li>
<li><a href="http://dawell.cc/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">SpringCloud-监控管理</a></li>
<li><a href="http://dawell.cc/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">SpringCloud-番外篇-临时任务</a></li>
<li><a href="http://dawell.cc/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/" target="_blank" rel="noopener">SpringCloud-番外篇-文档生成</a></li>
<li><a href="http://dawell.cc/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">SpringCloud-番外篇-源码解析</a></li>
</ol>
<h3 id="接入说明"><a href="#接入说明" class="headerlink" title="接入说明"></a>接入说明</h3><ol>
<li>目前采用最新的1.xRelease版本：1.5.15.RELEASE</li>
<li>SpringCloud项目可以在start.spring.io下载，不过更方便的应该是通过idea新建项目，建立Spring Initializr项目</li>
<li>我一般习惯将具体实现服务用具体的服务名，而公共组件用service-xxx来命名，当然还有一些比较固定名字的公共组件</li>
<li>基于配置中心，请先按照配置中心章节，配置公共配置</li>
</ol>
<h3 id="Zipkin"><a href="#Zipkin" class="headerlink" title="Zipkin"></a>Zipkin</h3><h4 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1. 新建项目"></a>1. 新建项目</h4><p>新建artifactId为zipkin-service的服务</p>
<h4 id="2-导入依赖"><a href="#2-导入依赖" class="headerlink" title="2. 导入依赖"></a>2. 导入依赖</h4><p>依赖说明</p>
<ol>
<li>actuator用于暴露监控的接口</li>
<li>eureka是Eureka客户端，注册到注册中心</li>
<li>config是Config客户端，从配置中心拉取配置</li>
<li>zipkin-server + zipkin-autoconfigure-ui是链路追踪客户端，用于监控链路调用<ol>
<li>注意这个依赖属于zipkin的ui，并不是springcloud包下，需要单独引用</li>
</ol>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.zipkin.java<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zipkin-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.zipkin.java<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zipkin-autoconfigure-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-编写启动类"><a href="#3-编写启动类" class="headerlink" title="3. 编写启动类"></a>3. 编写启动类</h4><p>打开ZipkinServiceApplication，在class上加入@EnableZipkinServer注解</p>
<h4 id="4-修改配置"><a href="#4-修改配置" class="headerlink" title="4. 修改配置"></a>4. 修改配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server.port=9411</span><br><span class="line">spring.application.name=zipkin-service</span><br><span class="line"></span><br><span class="line"># public</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka,http://localhost:8762/eureka</span><br><span class="line">spring.cloud.config.discovery.enabled=true</span><br><span class="line">spring.cloud.config.discovery.service-id=service-config</span><br><span class="line">zipkin.storage.type=mem</span><br></pre></td></tr></table></figure>
<p>zipkin.storage.type默认也是用mem，默认数据存储在内存中，可以用mysql之类的存储去存储收集的信息</p>
<h4 id="5-启动main"><a href="#5-启动main" class="headerlink" title="5. 启动main"></a>5. 启动main</h4><h4 id="6-验证"><a href="#6-验证" class="headerlink" title="6. 验证"></a>6. 验证</h4><p>访问 <a href="http://localhost:8761/" target="_blank" rel="noopener">http://localhost:8761/</a> 看到zipkin-service已经注册了一台<br>访问 <a href="http://localhost:9411/zipkin" target="_blank" rel="noopener">http://localhost:9411/zipkin</a> 看到服务端的UI界面，上面有查找调用链、依赖分析等功能</p>
<h3 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h3><h4 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-sleuth<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-zipkin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-开启注解"><a href="#2-开启注解" class="headerlink" title="2. 开启注解"></a>2. 开启注解</h4><p>无须添加注解</p>
<h4 id="3-修改配置"><a href="#3-修改配置" class="headerlink" title="3. 修改配置"></a>3. 修改配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring.sleuth.scheduled.enabled=false</span><br><span class="line">spring.sleuth.async.enabled=false</span><br><span class="line">spring.sleuth.annotation.enabled=false</span><br><span class="line">spring.sleuth.sampler.percentage=1</span><br><span class="line">spring.zipkin.sender.type=web</span><br></pre></td></tr></table></figure>
<p>scheduled.enabled与async.enabled关闭定时与异步推送数据，开启实时同步，可以更实时的看到数据<br>sampler.percentage采集率，用于控制多少比例的数据进行采集，默认是0.1，请求10次采集1次，这里设置为1，每一次调用都会采集<br>zipkin.sender.type设置为web才会直接请求到zipkin-server，否则如果依赖binders会默认是放在kafka中的，所以明确使用web方式调用</p>
<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><h4 id="除了通过web同步请求链路信息，还可以采用kafka异步采集信息"><a href="#除了通过web同步请求链路信息，还可以采用kafka异步采集信息" class="headerlink" title="除了通过web同步请求链路信息，还可以采用kafka异步采集信息"></a>除了通过web同步请求链路信息，还可以采用kafka异步采集信息</h4><p>zipkin.collector可以采用kafka收集信息，而客户端也可以配置为kafka发送信息</p>
<p>配置略…</p>
<h4 id="zipkin的数据可以采用mysql数据存储"><a href="#zipkin的数据可以采用mysql数据存储" class="headerlink" title="zipkin的数据可以采用mysql数据存储"></a>zipkin的数据可以采用mysql数据存储</h4><p>配置略…</p>
<h4 id="trace中的流转"><a href="#trace中的流转" class="headerlink" title="trace中的流转"></a>trace中的流转</h4><p>一个是多出了trace信息，同时注意最后一个状态位<br>日志中[demo-trace1,63c082f6715c8979,63c082f6715c8979,true],true代表上传成功；</p>
<p>如果开启了kafka的日志，则kafka消息中会多出4个trace相关的key，详见异步消息章节</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SpringCloud文章系列&quot;&gt;&lt;a href=&quot;#SpringCloud文章系列&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud文章系列&quot;&gt;&lt;/a&gt;SpringCloud文章系列&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
      <category term="技术" scheme="https://dawell.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringCloud" scheme="https://dawell.github.io/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-配置中心</title>
    <link href="https://dawell.github.io/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/"/>
    <id>https://dawell.github.io/2018/08/03/SpringCloud-配置中心/</id>
    <published>2018-08-03T12:10:50.000Z</published>
    <updated>2018-08-17T07:54:41.490Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud文章系列"><a href="#SpringCloud文章系列" class="headerlink" title="SpringCloud文章系列"></a>SpringCloud文章系列</h1><ol>
<li><a href="http://dawell.cc/2018/08/01/SpringCloud/" target="_blank" rel="noopener">SpringCloud</a></li>
<li><a href="http://dawell.cc/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-注册中心</a></li>
<li>【当前文章】<a href="http://dawell.cc/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-配置中心</a></li>
<li><a href="http://dawell.cc/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" target="_blank" rel="noopener">SpringCloud-链路跟踪</a></li>
<li><a href="http://dawell.cc/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" target="_blank" rel="noopener">SpringCloud-消息总线</a></li>
<li><a href="http://dawell.cc/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/" target="_blank" rel="noopener">SpringCloud-API网关</a></li>
<li><a href="http://dawell.cc/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/" target="_blank" rel="noopener">SpringCloud-异步消息</a></li>
<li><a href="http://dawell.cc/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/" target="_blank" rel="noopener">SpringCloud-同步调用</a></li>
<li><a href="http://dawell.cc/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/" target="_blank" rel="noopener">SpringCloud-断路降级</a></li>
<li><a href="http://dawell.cc/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">SpringCloud-监控管理</a></li>
<li><a href="http://dawell.cc/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">SpringCloud-番外篇-临时任务</a></li>
<li><a href="http://dawell.cc/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/" target="_blank" rel="noopener">SpringCloud-番外篇-文档生成</a></li>
<li><a href="http://dawell.cc/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">SpringCloud-番外篇-源码解析</a></li>
</ol>
<h3 id="接入说明"><a href="#接入说明" class="headerlink" title="接入说明"></a>接入说明</h3><ol>
<li>目前采用最新的1.xRelease版本：1.5.15.RELEASE</li>
<li>SpringCloud项目可以在start.spring.io下载，不过更方便的应该是通过idea新建项目，建立Spring Initializr项目</li>
<li>我一般习惯将具体实现服务用具体的服务名，而公共组件用service-xxx来命名，当然还有一些比较固定名字的公共组件</li>
</ol>
<h3 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h3><h4 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1. 新建项目"></a>1. 新建项目</h4><p>新建artifactId为service-config的服务</p>
<h4 id="2-导入依赖"><a href="#2-导入依赖" class="headerlink" title="2. 导入依赖"></a>2. 导入依赖</h4><p>依赖说明</p>
<ol>
<li>actuator用于暴露监控的接口</li>
<li>config-server是Config服务器的依赖</li>
<li>eureka是Eureka客户端，这里配置中心依赖于注册中心</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-编写启动类"><a href="#3-编写启动类" class="headerlink" title="3. 编写启动类"></a>3. 编写启动类</h4><p>打开ServiceConfigApplication，在class上加入@EnableConfigServer注解<br>并且加上@EnableEurekaClient，注册到注册中心</p>
<h4 id="4-修改配置"><a href="#4-修改配置" class="headerlink" title="4. 修改配置"></a>4. 修改配置</h4><h5 id="建立git仓库"><a href="#建立git仓库" class="headerlink" title="建立git仓库"></a>建立git仓库</h5><p>可以是本地仓库，也可以是远程仓库，我们用本地仓库来模拟</p>
<ol>
<li>找到一个目录E:/config</li>
<li>git init 初始化仓库</li>
<li>新建文件application.properties</li>
<li>git add .</li>
<li>git commit -m ‘init’</li>
<li>git push origin master</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server.port=8888</span><br><span class="line">spring.application.name=service-config</span><br><span class="line">spring.cloud.config.server.git.uri=E:/config</span><br><span class="line"></span><br><span class="line"># public</span><br><span class="line">spring.cloud.config.discovery.enabled=true</span><br><span class="line">spring.cloud.config.discovery.service-id=service-config</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka,http://localhost:8762/eureka</span><br><span class="line">management.security.enabled=false</span><br></pre></td></tr></table></figure>
<p>配置中心默认端口8888</p>
<p>config.server.git.uri设置为git的本地地址</p>
<ol>
<li>注意spring.cloud.config.server.git.uri必须配置在应用本地，否则不知道远程配置的地址，而其他服务的配置都可以放到配置中心，这个是特别的</li>
</ol>
<p>discovery.enabled与discovery.service-id其实是客户端的配置，配置中心自己是服务端也是客户端，作为客户端与其他服务一样，都需要通过配置中心去发现配置服务启动，读取公共配置</p>
<ol>
<li>discovery.enabled设置为通过注册中心暴露服务</li>
<li>discovery.service-id是配置中心对在注册中心外暴露的id一致，与server端配置的spring.application.name一致</li>
</ol>
<p>defaultZone注册中心地址<br>management.security.enabled用于关闭一些校验权限</p>
<h5 id="抽出公共配置–其他微服务共享"><a href="#抽出公共配置–其他微服务共享" class="headerlink" title="抽出公共配置–其他微服务共享"></a>抽出公共配置–其他微服务共享</h5><p>application.properties文件添加以下配置，并去掉service-config配置中的配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka,http://localhost:8762/eureka</span><br><span class="line">management.security.enabled=false</span><br><span class="line">spring.cloud.config.discovery.enabled=true</span><br><span class="line">spring.cloud.config.discovery.service-id=service-config</span><br></pre></td></tr></table></figure></p>
<h4 id="5-启动main"><a href="#5-启动main" class="headerlink" title="5. 启动main"></a>5. 启动main</h4><h4 id="6-验证"><a href="#6-验证" class="headerlink" title="6. 验证"></a>6. 验证</h4><p>访问 <a href="http://localhost:8761/" target="_blank" rel="noopener">http://localhost:8761/</a> 看到service-config已经注册了一台<br>访问 <a href="http://localhost:8888/service-config/default" target="_blank" rel="noopener">http://localhost:8888/service-config/default</a> 就可以访问到配置中心加载的配置了，中间改其他服务名，default是指配置的profile</p>
<h3 id="Config集群"><a href="#Config集群" class="headerlink" title="Config集群"></a>Config集群</h3><h4 id="1-修改配置文件"><a href="#1-修改配置文件" class="headerlink" title="1. 修改配置文件"></a>1. 修改配置文件</h4><p>配置2个server，server1使用端口8888，server2使用端口8889</p>
<p>server1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server.port=8888</span><br><span class="line">spring.application.name=service-config</span><br><span class="line">spring.cloud.config.server.git.uri=E:/IdeaProjects/springcloud-test/config</span><br><span class="line"></span><br><span class="line"># public</span><br><span class="line">spring.cloud.config.discovery.enabled=true</span><br><span class="line">spring.cloud.config.discovery.service-id=service-config</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka,http://localhost:8762/eureka</span><br><span class="line">management.security.enabled=false</span><br></pre></td></tr></table></figure></p>
<p>server2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server.port=8889</span><br><span class="line">spring.application.name=service-config</span><br><span class="line">spring.cloud.config.server.git.uri=E:/IdeaProjects/springcloud-test/config</span><br><span class="line"></span><br><span class="line"># public</span><br><span class="line">spring.cloud.config.discovery.enabled=true</span><br><span class="line">spring.cloud.config.discovery.service-id=service-config</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka,http://localhost:8762/eureka</span><br><span class="line">management.security.enabled=false</span><br></pre></td></tr></table></figure></p>
<p>除了端口号不一样，其他都一样，本质上配置中心只要保证读取的git地址一样就可以了，客户端只是过来拉配置，git相当于数据库</p>
<h4 id="2-启动"><a href="#2-启动" class="headerlink" title="2. 启动"></a>2. 启动</h4><p>启动server1<br>启动server2</p>
<h4 id="3-验证"><a href="#3-验证" class="headerlink" title="3. 验证"></a>3. 验证</h4><p>访问 <a href="http://localhost:8761/" target="_blank" rel="noopener">http://localhost:8761/</a> 看到service-config已经注册了2台<br>访问 <a href="http://localhost:8888/service-config/default" target="_blank" rel="noopener">http://localhost:8888/service-config/default</a> 就可以访问到配置中心加载的配置了<br>访问 <a href="http://localhost:8889/service-config/default" target="_blank" rel="noopener">http://localhost:8889/service-config/default</a> 就可以访问到配置中心加载的配置了</p>
<h3 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h3><h4 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h4><p>客户端要通过注册中心查找注册中心服务，所以需要依赖注册中心</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-开启注解"><a href="#2-开启注解" class="headerlink" title="2. 开启注解"></a>2. 开启注解</h4><p>开启注册中心的配置即可@EnableDiscoveryClient，配置中心不需要额外的注解</p>
<h4 id="3-修改配置"><a href="#3-修改配置" class="headerlink" title="3. 修改配置"></a>3. 修改配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka,http://localhost:8762/eureka</span><br><span class="line">spring.cloud.config.discovery.enabled=true</span><br><span class="line">spring.cloud.config.discovery.service-id=service-config</span><br></pre></td></tr></table></figure>
<p>config.discovery.enabled与config.discovery.service-id是依赖配置中心启动的核心配置，指定配置中心暴露的名称</p>
<h4 id="4-编写代码"><a href="#4-编写代码" class="headerlink" title="4. 编写代码"></a>4. 编写代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MessageController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MessageController</span><span class="params">(@Value(<span class="string">"$&#123;message&#125;"</span>)</span> String msg)</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg=msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/msg"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@RefreshScope 注意这里如果想通过/refresh接口能实时刷新配置的话，需要加这个注解，没有加的只是启动时加载的数据不会更新<br>注意这里进来保持好的使用习惯，使用final来保存数据</p>
<h3 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h3><h4 id="1-为什么一定通过注册中心暴露配置中心服务？"><a href="#1-为什么一定通过注册中心暴露配置中心服务？" class="headerlink" title="1. 为什么一定通过注册中心暴露配置中心服务？"></a>1. 为什么一定通过注册中心暴露配置中心服务？</h4><p>如果不通过注册中心，客户端的配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.config.uri=http://localhost:8888</span><br></pre></td></tr></table></figure></p>
<p>如果修改修改了域名或者端口，增加减少机器都需要去修改此启动配置，则通过注册中心就可以用其各种好处，减少依赖</p>
<h4 id="2-配置中心为什么依赖注册中心？怎么我看有的是注册中心依赖配置中心？"><a href="#2-配置中心为什么依赖注册中心？怎么我看有的是注册中心依赖配置中心？" class="headerlink" title="2. 配置中心为什么依赖注册中心？怎么我看有的是注册中心依赖配置中心？"></a>2. 配置中心为什么依赖注册中心？怎么我看有的是注册中心依赖配置中心？</h4><p>其实目前2种配置都有</p>
<ol>
<li>注册中心依赖配置中心的解释：就是注册中心也是一个服务，启动所需要的配置从配置中心拉取，同时可以动态变更，启动顺序：先配置中心，再注册中心，配置中心不能依赖注册中心，否则无法启动。</li>
<li>配置中心依赖注册中心的解释：配置中心如果注册为集群模式那必然让客户端通过服务发现找到从注册中心找到配置中心，所以配置中心一定要注册到注册中心启动服务发现。启动顺序：注册中心，再配置中心，这样注册中心的配置是不经过配置中心的，而注册中心的配置一般也是固定不变的<br>针对第一种还有一种解：先启动配置中心，开启注册失败仍然可以启动的配置，只是第一次注册失败依然可以启动，然后再启动注册中心，可以两全<br>总体来说第二种更加合理一点，因为一般注册中心的defaultZone与其他应用不一样，注册中心的要排除掉自己的地址，而其他服务是全量，这样我在做公共配置时比较统一，不用开启注册中心的本地配置优先<br>不过其他解决方案中注册中心与配置中心一般都是一体的，所以也就没有这种相互依赖的尴尬，不过领域上确实是2个东西</li>
</ol>
<h4 id="3-为什么配置中心读取的配置变量声明为final的，但是调用-refresh后带-RefreshScope的对象里的final值还会发生变化？"><a href="#3-为什么配置中心读取的配置变量声明为final的，但是调用-refresh后带-RefreshScope的对象里的final值还会发生变化？" class="headerlink" title="3. 为什么配置中心读取的配置变量声明为final的，但是调用/refresh后带@RefreshScope的对象里的final值还会发生变化？"></a>3. 为什么配置中心读取的配置变量声明为final的，但是调用/refresh后带@RefreshScope的对象里的final值还会发生变化？</h4><p>首先final是不会变的，所以spring是把整个@RefreshScope标注的bean重新创建了一遍<br>final的好处是</p>
<ol>
<li>控制只有配置中心才可以更改变量，在程序中是无法赋值替换的</li>
<li>配置中心的数据都是很少去变化的，应该当做常量处理，final虚拟机有优化</li>
<li>可以保证线程安全，无状态类与不可变类多线程安全</li>
</ol>
<h3 id="其他注册中心"><a href="#其他注册中心" class="headerlink" title="其他注册中心"></a>其他注册中心</h3><p>因为consul与zookeeper本身具备配置存储的能力，所以这2个注册中心的配置中心一般用他们定制的，而非用SpringCloudConfig</p>
<h4 id="快速接入"><a href="#快速接入" class="headerlink" title="快速接入"></a>快速接入</h4><p>暂略…</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SpringCloud文章系列&quot;&gt;&lt;a href=&quot;#SpringCloud文章系列&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud文章系列&quot;&gt;&lt;/a&gt;SpringCloud文章系列&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
      <category term="技术" scheme="https://dawell.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringCloud" scheme="https://dawell.github.io/tags/SpringCloud/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud-注册中心</title>
    <link href="https://dawell.github.io/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/"/>
    <id>https://dawell.github.io/2018/08/02/SpringCloud-注册中心/</id>
    <published>2018-08-02T11:29:32.000Z</published>
    <updated>2018-08-17T07:54:41.370Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SpringCloud文章系列"><a href="#SpringCloud文章系列" class="headerlink" title="SpringCloud文章系列"></a>SpringCloud文章系列</h1><ol>
<li><a href="http://dawell.cc/2018/08/01/SpringCloud/" target="_blank" rel="noopener">SpringCloud</a></li>
<li>【当前文章】<a href="http://dawell.cc/2018/08/02/SpringCloud-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-注册中心</a></li>
<li><a href="http://dawell.cc/2018/08/03/SpringCloud-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">SpringCloud-配置中心</a></li>
<li><a href="http://dawell.cc/2018/08/04/SpringCloud-%E9%93%BE%E8%B7%AF%E8%B7%9F%E8%B8%AA/" target="_blank" rel="noopener">SpringCloud-链路跟踪</a></li>
<li><a href="http://dawell.cc/2018/08/05/SpringCloud-%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF/" target="_blank" rel="noopener">SpringCloud-消息总线</a></li>
<li><a href="http://dawell.cc/2018/08/06/SpringCloud-API%E7%BD%91%E5%85%B3/" target="_blank" rel="noopener">SpringCloud-API网关</a></li>
<li><a href="http://dawell.cc/2018/08/07/SpringCloud-%E5%BC%82%E6%AD%A5%E6%B6%88%E6%81%AF/" target="_blank" rel="noopener">SpringCloud-异步消息</a></li>
<li><a href="http://dawell.cc/2018/08/08/SpringCloud-%E5%90%8C%E6%AD%A5%E8%B0%83%E7%94%A8/" target="_blank" rel="noopener">SpringCloud-同步调用</a></li>
<li><a href="http://dawell.cc/2018/08/09/SpringCloud-%E6%96%AD%E8%B7%AF%E9%99%8D%E7%BA%A7/" target="_blank" rel="noopener">SpringCloud-断路降级</a></li>
<li><a href="http://dawell.cc/2018/08/10/SpringCloud-%E7%9B%91%E6%8E%A7%E7%AE%A1%E7%90%86/" target="_blank" rel="noopener">SpringCloud-监控管理</a></li>
<li><a href="http://dawell.cc/2018/08/11/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E4%B8%B4%E6%97%B6%E4%BB%BB%E5%8A%A1/" target="_blank" rel="noopener">SpringCloud-番外篇-临时任务</a></li>
<li><a href="http://dawell.cc/2018/08/12/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90/" target="_blank" rel="noopener">SpringCloud-番外篇-文档生成</a></li>
<li><a href="http://dawell.cc/2018/08/13/SpringCloud-%E7%95%AA%E5%A4%96%E7%AF%87-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" target="_blank" rel="noopener">SpringCloud-番外篇-源码解析</a></li>
</ol>
<h3 id="接入说明"><a href="#接入说明" class="headerlink" title="接入说明"></a>接入说明</h3><ol>
<li>目前采用最新的1.xRelease版本：1.5.15.RELEASE</li>
<li>SpringCloud项目可以在start.spring.io下载，不过更方便的应该是通过idea新建项目，建立Spring Initializr项目</li>
<li>我一般习惯将具体实现服务用具体的服务名，而公共组件用service-xxx来命名，当然还有一些比较固定名字的公共组件</li>
</ol>
<h3 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h3><h4 id="1-新建项目"><a href="#1-新建项目" class="headerlink" title="1. 新建项目"></a>1. 新建项目</h4><p>新建artifactId为eureka-service的服务</p>
<h4 id="2-导入依赖"><a href="#2-导入依赖" class="headerlink" title="2. 导入依赖"></a>2. 导入依赖</h4><p>依赖说明</p>
<ol>
<li>actuator用于暴露监控的接口</li>
<li>eureka-server是Eureka服务器的依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-编写启动类"><a href="#3-编写启动类" class="headerlink" title="3. 编写启动类"></a>3. 编写启动类</h4><p>打开EurekaServiceApplication，在class上加入@EnableEurekaServer注解</p>
<h4 id="4-修改配置"><a href="#4-修改配置" class="headerlink" title="4. 修改配置"></a>4. 修改配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server.port=8761</span><br><span class="line">spring.application.name=eureka-service</span><br><span class="line"></span><br><span class="line"># private</span><br><span class="line">eureka.client.register-with-eureka=false</span><br><span class="line">eureka.client.fetch-registry=false</span><br></pre></td></tr></table></figure>
<p>注册中心默认端口号8761<br>eureka.client.register-with-eureka代表开启自我注册，单机关闭<br>eureka.client.fetch-registry用于开启同步其他Eureka数据，单机关闭</p>
<h4 id="5-启动main"><a href="#5-启动main" class="headerlink" title="5. 启动main"></a>5. 启动main</h4><h4 id="6-验证"><a href="#6-验证" class="headerlink" title="6. 验证"></a>6. 验证</h4><p>访问 <a href="http://localhost:8761/" target="_blank" rel="noopener">http://localhost:8761/</a> 可以看到单台的”System Status”、”DS Replicas”、”Instances currently registered”、”General Info”、”Instance Info”<br>Instance Info的status为UP，说明启动成功</p>
<h3 id="Eureka集群"><a href="#Eureka集群" class="headerlink" title="Eureka集群"></a>Eureka集群</h3><p>作为注册中心，是非常关键的服务，几乎所有服务的启动与调用都依赖于注册中心，需要保证注册中心高可用，所以Eureka一般配置为集群模式</p>
<p>如果不清楚在同一个工程中如何启动2种不同配置的服务器，请观看文章：<a href="">idea中同项目不同端口与配置启动多个步骤</a></p>
<h4 id="1-修改配置文件"><a href="#1-修改配置文件" class="headerlink" title="1. 修改配置文件"></a>1. 修改配置文件</h4><p>配置2个server，server1使用端口8761，server2使用端口8762</p>
<p>server1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server.port=8761</span><br><span class="line">spring.application.name=eureka-service</span><br><span class="line"></span><br><span class="line"># private</span><br><span class="line">eureka.client.register-with-eureka=true</span><br><span class="line">eureka.client.fetch-registry=true</span><br><span class="line">eureka.client.service-url.defaultZone=http://localhost:8762/eureka</span><br></pre></td></tr></table></figure></p>
<p>server2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server.port=8762</span><br><span class="line">spring.application.name=eureka-service</span><br><span class="line"></span><br><span class="line"># private</span><br><span class="line">eureka.client.register-with-eureka=true</span><br><span class="line">eureka.client.fetch-registry=true</span><br><span class="line">eureka.client.service-url.defaultZone=http://localhost:8761/eureka</span><br></pre></td></tr></table></figure></p>
<p>如果超过2台的集群怎么配置？</p>
<ol>
<li>defaultZone可以配置多个用”,”隔开，其实链接其中一个就能整个集群链接同步，不过一般担心某一台出现问题，还是配置多台</li>
</ol>
<h4 id="2-启动"><a href="#2-启动" class="headerlink" title="2. 启动"></a>2. 启动</h4><p>启动server1<br>启动server2</p>
<h4 id="3-验证"><a href="#3-验证" class="headerlink" title="3. 验证"></a>3. 验证</h4><p>访问 <a href="http://localhost:8761/" target="_blank" rel="noopener">http://localhost:8761/</a> 看到”Instances currently registered”中EUREKA-SERVICE的UP是2个<br><a href="http://localhost:8762/" target="_blank" rel="noopener">http://localhost:8762/</a> 看到”Instances currently registered”中EUREKA-SERVICE的UP是2个</p>
<h3 id="客户端使用"><a href="#客户端使用" class="headerlink" title="客户端使用"></a>客户端使用</h3><h4 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-开启注解"><a href="#2-开启注解" class="headerlink" title="2. 开启注解"></a>2. 开启注解</h4><p>启动类+@EnableEurekaClient</p>
<h4 id="3-修改配置"><a href="#3-修改配置" class="headerlink" title="3. 修改配置"></a>3. 修改配置</h4><p>eureka.client.serviceUrl.defaultZone的默认值是 <a href="http://localhost:8761" target="_blank" rel="noopener">http://localhost:8761</a></p>
<p>基于以上集群可以配置如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=xxx-service</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka,http://localhost:8762/eureka</span><br></pre></td></tr></table></figure>
<p>注意事项</p>
<ol>
<li>/eureka这个必须加上，否则是注册不上去的</li>
<li>spring.application.name是必须设置的，用于标识注册中心中服务的名称</li>
</ol>
<h4 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h4><p>为什么客户端也需要配置2台，配置1台可以么？<br>可以配置一台。如果之前已经注册过server1了，会同步给server2，即使server1挂了，注册上的服务依然可以通过server2路由到<br>但是如果server1挂了，则后续只指定server1的client就无法启动成功，无法注册到Eureka上，所以为了启动注册的高可用需要配置多台</p>
<ol>
<li>优化：后续公共配置可以抽离到配置中心中，避免修改不同步问题，后续配置中心章节会讲</li>
</ol>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ol>
<li>spring.application.name 不能包含下划线，因为在eureka中java.net.URI不能区分下划线，否则在进行服务调用的时候报错（host name may not be null）；</li>
<li>注意eureka的Maven坐标发布过2种命名方式，其中一种已经废弃，使用最新版的命名可以保证后续更新（明确了客户端与服务器依赖，与公司名称）<ol>
<li>历史上的废弃版本：spring-cloud-starter-eureka与spring-cloud-starter-eureka-server</li>
<li>最新版本命名：spring-cloud-starter-netflix-eureka-client与spring-cloud-starter-netflix-eureka-server</li>
</ol>
</li>
</ol>
<h3 id="SpringCloud注册中心抽象层"><a href="#SpringCloud注册中心抽象层" class="headerlink" title="SpringCloud注册中心抽象层"></a>SpringCloud注册中心抽象层</h3><p>目前用到的注解都是@EnableEurekaClient，@EnableEurekaServer，而且配置都是eureka开头的，耦合了Eureka<br>其实为了方便替换注册中心实现，或者规范配置中心，SpringCloud针对多种实现提供一个抽象层，提供了通用的注解与配置，Eureka也是其中的一种实现而已</p>
<h4 id="抽象层配置"><a href="#抽象层配置" class="headerlink" title="抽象层配置"></a>抽象层配置</h4><p>主要防止客户端的强依赖，所以只提供了客户端的注解，服务端直接就是具体的注册中心实现<br>客户端注解：@EnableDiscoveryClient<br>客户端配置：略…</p>
<h3 id="其他注册中心"><a href="#其他注册中心" class="headerlink" title="其他注册中心"></a>其他注册中心</h3><p>目前业界有Consul、Zookeeper、etcd等实现方案，这里列举常用的2种</p>
<h3 id="快速接入"><a href="#快速接入" class="headerlink" title="快速接入"></a>快速接入</h3><h4 id="Consul"><a href="#Consul" class="headerlink" title="Consul"></a>Consul</h4><p>下载consul启动，server.port=8503，spring.cloud.consul.host=127.0.0.1，spring.cloud.consul.port=8500 #设置不需要注册到 consul 中spring.cloud.consul.discovery.register=false 消费端可以不注册<br>    服务器：spring-boot-starter-actuator + spring-cloud-starter-consul-discovery + @EnableDiscoveryClient spring.cloud.consul.host spring.cloud.consul.port=8500  spring.cloud.consul.discovery.serviceName=service-producer</p>
<h4 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h4><p>dependencys:spring-cloud-zookeeper-dependencies + spring-cloud-zookeeper-discovery + Apache Curator + Zookeeper Java Client + @EnableDiscoveryClient：自动连接 <a href="http://localhost:2181" target="_blank" rel="noopener">http://localhost:2181</a> 的注册中心（zookeeper.connectString）<br>    服务器：zookeeper集群</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;SpringCloud文章系列&quot;&gt;&lt;a href=&quot;#SpringCloud文章系列&quot; class=&quot;headerlink&quot; title=&quot;SpringCloud文章系列&quot;&gt;&lt;/a&gt;SpringCloud文章系列&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;htt
    
    </summary>
    
      <category term="技术" scheme="https://dawell.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="SpringCloud" scheme="https://dawell.github.io/tags/SpringCloud/"/>
    
  </entry>
  
</feed>
